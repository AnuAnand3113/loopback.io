"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[6492],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(n),m=o,h=u["".concat(p,".").concat(m)]||u[m]||c[m]||r;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8460:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return s},assets:function(){return d},toc:function(){return c},default:function(){return m}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],l={title:"Building an Online Game With LoopBack 4, Part 2 - Generating Universally Unique ID and Managing Models Relationships",date:new Date("2019-05-15T00:00:00.000Z"),authors:"wenbo",slug:"building-an-online-game-with-loopback-4-pt2",tags:["how-to"]},p=void 0,s={permalink:"/blog/building-an-online-game-with-loopback-4-pt2",editUrl:"https://github.com/loopbackio/loopback-blog/blog/2019/2019-05-15-building-an-online-game-with-loopback-4-pt2.md",source:"@site/blog/2019/2019-05-15-building-an-online-game-with-loopback-4-pt2.md",title:"Building an Online Game With LoopBack 4, Part 2 - Generating Universally Unique ID and Managing Models Relationships",description:"Part 2: Generating Universally Unique ID and Managing Models Relationships",date:"2019-05-15T00:00:00.000Z",formattedDate:"May 15, 2019",tags:[{label:"how-to",permalink:"/blog/tags/how-to"}],readingTime:8.395,truncated:!0,authors:[{name:"Wen Bo",title:"LoopBack Maintainer",url:"https://github.com/gobackhuoxing",imageURL:"https://avatars.githubusercontent.com/u/22156589",key:"wenbo"}],frontMatter:{title:"Building an Online Game With LoopBack 4, Part 2 - Generating Universally Unique ID and Managing Models Relationships",date:"2019-05-15T00:00:00.000Z",authors:"wenbo",slug:"building-an-online-game-with-loopback-4-pt2",tags:["how-to"]},prevItem:{title:"Building an Online Game With LoopBack 4 - Customizing APIs in Controller (Part 3)",permalink:"/blog/building-an-online-game-with-loopback-4-pt3"},nextItem:{title:"LoopBack 4 April 2019 Milestone Update",permalink:"/blog/april-2019-milestone"}},d={authorsImageUrls:[void 0]},c=[{value:"Part 2: Generating Universally Unique ID and Managing Models Relationships",id:"part-2-generating-universally-unique-id-and-managing-models-relationships",children:[{value:"Introduction",id:"introduction",children:[],level:3},{value:"Previously on Building an Online Game With LoopBack 4",id:"previously-on-building-an-online-game-with-loopback-4",children:[],level:3},{value:"In This Episode",id:"in-this-episode",children:[],level:3},{value:"Universally Unique ID (UUID)",id:"universally-unique-id-uuid",children:[],level:3},{value:"Model Relations",id:"model-relations",children:[{value:"Model",id:"model",children:[],level:4},{value:"Defining <code>hasOne</code> Model Relation in Model",id:"defining-hasone-model-relation-in-model",children:[],level:4},{value:"Datasource",id:"datasource",children:[],level:4},{value:"Repository",id:"repository",children:[],level:4},{value:"Defining <code>hasOne</code> Model Relation in Repository",id:"defining-hasone-model-relation-in-repository",children:[],level:4}],level:3},{value:"Applying This to Your Own Project",id:"applying-this-to-your-own-project",children:[],level:3},{value:"What&#39;s Next?",id:"whats-next",children:[],level:3}],level:2}],u={toc:c};function m(e){var t=e.components,l=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"part-2-generating-universally-unique-id-and-managing-models-relationships"},"Part 2: Generating Universally Unique ID and Managing Models Relationships"),(0,r.kt)("h3",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"In this series, I\u2019m going to help you learn LoopBack 4 and how to use it to easily build your own API and web project. We\u2019ll create a new project I\u2019ve been working on: an online web text-based adventure game. In this game, you can create your own account to build characters, fight monsters and find treasures. You will be able to control your character to take a variety of actions: attacking enemies, casting spells, and getting loot. This game also allows multiple players to log in and play with their friends."),(0,r.kt)("h3",{id:"previously-on-building-an-online-game-with-loopback-4"},"Previously on Building an Online Game With LoopBack 4"),(0,r.kt)("p",null,"In the previous episode, we created a foundation for our project. Now we have some basic APIs to create, edit, and delete a character."),(0,r.kt)("p",null,"Here is the previous episode:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://strongloop.com/strongblog/building-online-game-with-loopback-4-pt1/"},"Part 1: Building a Simple LoopBack Project With MongoDB"))),(0,r.kt)("h3",{id:"in-this-episode"},"In This Episode"),(0,r.kt)("p",null,"First, we will use a third-party library in our LoopBack 4 project to generate unique character IDs. Then we will create ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"armor"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"skill")," models and build relationships between those models."),(0,r.kt)("p",null,"Loopback 4 supports three relations for now:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://loopback.io/doc/en/lb4/HasMany-relation.html"},"HasMany")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://loopback.io/doc/en/lb4/BelongsTo-relation.html"},"BelongsTo")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://loopback.io/doc/en/lb4/hasOne-relation.html"},"HasOne"))),(0,r.kt)("p",null,"We will use ",(0,r.kt)("inlineCode",{parentName:"p"},"HasOne")," in this episode."),(0,r.kt)("p",null,"You can check ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gobackhuoxing/first-web-game-lb4/tree/part2"},"here")," for the code of this episode."),(0,r.kt)("h3",{id:"universally-unique-id-uuid"},"Universally Unique ID (UUID)"),(0,r.kt)("p",null,"In the last episode, we used a while loop to generate continuous character IDs. However, that could be disaster in a real world application. Because fetching data from database is expensive. We don't want to do that hundreds times to just find a unique character ID. On the other hand, we don't really need continuous IDs, just unique IDs to distinguish characters. So we will use a better approach to generate universally unique IDs (UUID)."),(0,r.kt)("p",null,"MongoDB can generate unique IDs for us. You can check more details ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/strongloop/loopback-next/issues/1875"},"here")," for how to do that. However, this approach may result in changing a lot of code."),(0,r.kt)("p",null,"So, we are going to use a third-party library called ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/uuid"},"uuid"),". It's very easy to use and I think it's a good idea to show you how to use a third-party library in LoopBack 4 project. Run ",(0,r.kt)("inlineCode",{parentName:"p"},"npm install --save @types/uuid")," at your project root to install it."),(0,r.kt)("p",null,"Then go back to ",(0,r.kt)("inlineCode",{parentName:"p"},"src/models/character.model.ts")," and change the type of ",(0,r.kt)("inlineCode",{parentName:"p"},"id")," to string. Because ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/uuid"},"uuid")," can only generate string IDs."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"  @property({\n    //type: 'number',\n    type: 'string',\n    id: true,\n  })\n  //id?: number;\n  id?: string;\n")),(0,r.kt)("p",null,"Go to ",(0,r.kt)("inlineCode",{parentName:"p"},"src/controllers/character.controller.ts"),". In the ",(0,r.kt)("inlineCode",{parentName:"p"},"get /characters/{id}")," API, change the type of ",(0,r.kt)("inlineCode",{parentName:"p"},"id")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"string"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"  @get('/characters/{id}', {\n    responses: {\n      '200': {\n        description: 'Character model instance',\n        content: {'application/json': {schema: {'x-ts-type': Character}}},\n      },\n    },\n  })\n  async findById(\n    //@param.path.number('id') id: number\n    @param.path.string('id') id: string\n  ): Promise<Character> {\n    return await this.characterRepository.findById(id);\n  }\n")),(0,r.kt)("p",null,"Then do the same thing for ",(0,r.kt)("inlineCode",{parentName:"p"},"patch /characters/{id}"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"put /characters/{id}"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"del /characters/{id}")," APIs."),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/uuid"},"uuid")," can generate 36 digits string IDs. The implementation of uuid library is using some high distinction values (like DNS, local time, IP address etc) as the seed to randomly generate strings to reduce the chance of duplication. We can simply call the function ",(0,r.kt)("inlineCode",{parentName:"p"},"uuid()")," to use this library."),(0,r.kt)("p",null,"Remember how we generated a character ID in the last episode? We can do it in a very elegant way by using ",(0,r.kt)("inlineCode",{parentName:"p"},"default")," keyword in ",(0,r.kt)("inlineCode",{parentName:"p"},"model"),"."),(0,r.kt)("p",null,"Open ",(0,r.kt)("inlineCode",{parentName:"p"},"src/controllers/character.controller.ts")," and remove following code from ",(0,r.kt)("inlineCode",{parentName:"p"},"post /characters")," API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"@post('/characters', {\n  responses: {\n    '200': {\n      description: 'Character model instance',\n      content: {'application/json': {schema: {'x-ts-type': Character}}},\n    },\n  },\n})\nasync create(@requestBody() character: Character): Promise<Character> {\n  /**remove this\n  let characterId = 1;\n  while(await this.characterRepository.exists(characterId)){\n    characterId ++;\n  }\n  character.id = characterId;\n  */\n    return await this.characterRepository.create(character);\n}\n")),(0,r.kt)("p",null,"Open ",(0,r.kt)("inlineCode",{parentName:"p"},"src/models/character.model.ts"),", and add the following import. This will import ",(0,r.kt)("inlineCode",{parentName:"p"},"uuid")," so we can use it in our code."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import {v4 as uuid} from 'uuid';\n")),(0,r.kt)("p",null,"Add the following line to generate character ID as ",(0,r.kt)("inlineCode",{parentName:"p"},"default"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"  @property({\n    type: 'string',\n    id: true,\n    //add this line\n    default: () => uuid(),\n  })\n  id?: string;\n")),(0,r.kt)("p",null,"That is how we generate UUID for ",(0,r.kt)("inlineCode",{parentName:"p"},"character"),". We will use the same way to generate UUID for other models later."),(0,r.kt)("h3",{id:"model-relations"},"Model Relations"),(0,r.kt)("p",null,"We will create ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"armor"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"skill")," models. Each ",(0,r.kt)("inlineCode",{parentName:"p"},"character")," may have one ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon"),", one ",(0,r.kt)("inlineCode",{parentName:"p"},"armor"),", and one ",(0,r.kt)("inlineCode",{parentName:"p"},"skill"),". It is a ",(0,r.kt)("a",{parentName:"p",href:"https://loopback.io/doc/en/lb4/hasOne-relation.html"},"HasOne")," relationship."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Models",src:n(2705).Z,width:"1206",height:"826"})),(0,r.kt)("p",null,"Last episode, we built APIs for ",(0,r.kt)("inlineCode",{parentName:"p"},"character")," in the order of model, datasource, repository, and controller. Now we will do it in the same way for ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"armor"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"skill"),". Note that we are not going to cover controller today, because I will have a whole episode focused on the work required (and there is a lot!)."),(0,r.kt)("h4",{id:"model"},"Model"),(0,r.kt)("p",null,"First, we need to create ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon")," model. It's very similar to what we did in last episode. Run ",(0,r.kt)("inlineCode",{parentName:"p"},"lb4 model")," at project root."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"wenbo:firstgame wenbo$ lb4 model\n? Model class name: weapon\n? Please select the model base class Entity (A persisted model with an ID)\n? Allow additional (free-form) properties? No\nLet's add a property to Weapon\nEnter an empty property name when done\n\n? Enter the property name: id\n? Property type: string\n? Is id the ID property? Yes\n? Is it required?: No\n? Default value [leave blank for none]:\n\nLet's add another property to Weapon\nEnter an empty property name when done\n\n? Enter the property name: name\n? Property type: string\n? Is it required?: Yes\n? Default value [leave blank for none]:\n\nLet's add another property to Weapon\nEnter an empty property name when done\n\n? Enter the property name: attack\n? Property type: number\n? Is it required?: Yes\n? Default value [leave blank for none]:\n\nLet's add another property to Weapon\nEnter an empty property name when done\n\n? Enter the property name: defence\n? Property type: number\n? Is it required?: Yes\n? Default value [leave blank for none]:\n")),(0,r.kt)("p",null,"Do the same thing for ",(0,r.kt)("inlineCode",{parentName:"p"},"armor")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"skill"),"."),(0,r.kt)("h4",{id:"defining-hasone-model-relation-in-model"},"Defining ",(0,r.kt)("inlineCode",{parentName:"h4"},"hasOne")," Model Relation in Model"),(0,r.kt)("p",null,"Now let's add relationships to ",(0,r.kt)("inlineCode",{parentName:"p"},"character")," model to indicate that a ",(0,r.kt)("inlineCode",{parentName:"p"},"character")," has one ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"armor"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"skill"),". You can check ",(0,r.kt)("a",{parentName:"p",href:"https://loopback.io/doc/en/lb4/Relations.html"},"here")," for more details on model relationship. You can also take a look at the ",(0,r.kt)("a",{parentName:"p",href:"https://loopback.io/doc/en/lb4/todo-list-tutorial-model.html"},"TodoList tutorial")," to see how it handles a relationship."),(0,r.kt)("p",null,"Add the following imports to the head of ",(0,r.kt)("inlineCode",{parentName:"p"},"character.model.ts"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import {Armor} from './armor.model';\nimport {Weapon} from './weapon.model';\nimport {Skill} from './skill.model';\n")),(0,r.kt)("p",null,"Then add the following code into ",(0,r.kt)("inlineCode",{parentName:"p"},"character.model.ts")," after those auto-generated properties. That means each ",(0,r.kt)("inlineCode",{parentName:"p"},"character")," may have one ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"armor"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"skill"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"  @hasOne(() => Armor)\n  armor?: Armor;\n\n  @hasOne(() => Weapon)\n  weapon?: Weapon;\n\n  @hasOne(() => Skill)\n  skill?: Skill;\n")),(0,r.kt)("p",null,"Next, we need to add a relationship for ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon.model.ts")," as well. Add the following imports to the head."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import {Character} from './character.model';\nimport {v4 as uuid} from 'uuid';\n")),(0,r.kt)("p",null,"Then add this code after those auto-generated properties."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"  @belongsTo(() => Character)\n    characterId: string;\n")),(0,r.kt)("p",null,"This gives ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon")," another property ",(0,r.kt)("inlineCode",{parentName:"p"},"characterId")," means identifies the character this weapon belongs to. It's similar to the foreign key in a relational database."),(0,r.kt)("p",null,"Don't forget to generate UUID for ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"@property({\n  type: 'string',\n  id: true,\n  //add this line\n  default: () => uuid(),\n})\nid?: string;\n")),(0,r.kt)("p",null,"Do the same thing for ",(0,r.kt)("inlineCode",{parentName:"p"},"armor.model.ts")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"skill.model.ts"),". Now our models are all set."),(0,r.kt)("p",null,"You can check my code for all models at ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gobackhuoxing/first-web-game-lb4/tree/part2/firstgame/src/models"},"here"),"."),(0,r.kt)("h4",{id:"datasource"},"Datasource"),(0,r.kt)("p",null,"There is no need to create new datasource. We can use the MongoDB we created in last episode."),(0,r.kt)("h4",{id:"repository"},"Repository"),(0,r.kt)("p",null,"Run ",(0,r.kt)("inlineCode",{parentName:"p"},"lb4 repository")," at your project root."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"? Please select the datasource MongoDatasource\n? Select the model(s) you want to generate a repository Weapon\n? Please select the repository base class DefaultCrudRepository (Legacy juggler bridge)\n   create src/repositories/weapon.repository.ts\n   update src/repositories/index.ts\n")),(0,r.kt)("p",null,"Then create repositories for ",(0,r.kt)("inlineCode",{parentName:"p"},"armor")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"skill")," in the same way."),(0,r.kt)("h4",{id:"defining-hasone-model-relation-in-repository"},"Defining ",(0,r.kt)("inlineCode",{parentName:"h4"},"hasOne")," Model Relation in Repository"),(0,r.kt)("p",null,"Let's add relations for ",(0,r.kt)("inlineCode",{parentName:"p"},"character.repository.ts")," first. Add following imports:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import {HasOneRepositoryFactory, juggler, repository} from '@loopback/repository';\nimport {Armor, Weapon, Skill} from '../models';\nimport {Getter} from '@loopback/core';\nimport {ArmorRepository} from './armor.repository';\nimport {WeaponRepository} from './weapon.repository';\nimport {SkillRepository} from './skill.repository';\n")),(0,r.kt)("p",null,"Add the following code before the constructor:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"  public armor: HasOneRepositoryFactory<\n    Armor,\n    typeof Character.prototype.id\n  >;\n\n  public weapon: HasOneRepositoryFactory<\n    Weapon,\n    typeof Character.prototype.id\n  >;\n\n  public skill: HasOneRepositoryFactory<\n    Skill,\n    typeof Character.prototype.id\n  >;\n")),(0,r.kt)("p",null,"This means ",(0,r.kt)("inlineCode",{parentName:"p"},"character")," may have one ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"armor"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"skill")," ID. Then we are able to find the correct entity by that ID."),(0,r.kt)("p",null,"Then change the constructor to this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"  constructor(\n    @inject('datasources.mongo') dataSource: MongoDataSource,\n    @repository.getter(ArmorRepository)\n    protected armorRepositoryGetter: Getter<ArmorRepository>,\n    @repository.getter(WeaponRepository)\n    protected weaponRepositoryGetter: Getter<WeaponRepository>,\n    @repository.getter(SkillRepository)\n    protected skillRepositoryGetter: Getter<SkillRepository>,\n  ) {\n    super(Character, dataSource);\n    this.armor = this.createHasOneRepositoryFactoryFor('armor', armorRepositoryGetter);\n    this.weapon = this.createHasOneRepositoryFactoryFor('weapon', weaponRepositoryGetter);\n    this.skill = this.createHasOneRepositoryFactoryFor('skill', skillRepositoryGetter);\n  }\n")),(0,r.kt)("p",null,"This can help you to assign ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"armor"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"skill")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"character.")),(0,r.kt)("p",null,"On the other hand, what we need to do for the ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon.repository.ts")," is kind of the same. Instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"HasOneRepositoryFactory"),", we add ",(0,r.kt)("inlineCode",{parentName:"p"},"BelongsToAccessor")," before constructor."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"  public readonly character: BelongsToAccessor<\n    Character,\n    typeof Weapon.prototype.id\n  >;\n")),(0,r.kt)("p",null,"And change the constructor to this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"  constructor(\n    @inject('datasources.mongo') dataSource: MongoDataSource,\n    @repository.getter('CharacterRepository')\n    protected characterRepositoryGetter: Getter<CharacterRepository>,\n  ) {\n    super(Weapon, dataSource);\n    this.character = this.createBelongsToAccessorFor('character',characterRepositoryGetter);\n  }\n")),(0,r.kt)("p",null,"Don't forget to add imports at the head of ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon.repository.ts"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"import {BelongsToAccessor, juggler, repository} from '@loopback/repository';\nimport {Character} from '../models';\nimport {inject} from '@loopback/core';\nimport {CharacterRepository} from './character.repository';\n")),(0,r.kt)("p",null,"Then do the same thing for ",(0,r.kt)("inlineCode",{parentName:"p"},"armor.repository.ts")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"skill.repository.ts"),". And our repositories are all set."),(0,r.kt)("p",null,"You can check my code for all repositories at ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/gobackhuoxing/first-web-game-lb4/tree/part2/firstgame/src/repositories"},"here"),"."),(0,r.kt)("h3",{id:"applying-this-to-your-own-project"},"Applying This to Your Own Project"),(0,r.kt)("p",null,"In this episode, we used a third-party library to generate UUID. You can easily use any external library in you LoopBack 4 project."),(0,r.kt)("p",null,"We also built relations between ",(0,r.kt)("inlineCode",{parentName:"p"},"character"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"aromr"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"skill"),". In a real world application, most of entities have relationships between each other. You can use LoopBack 4 to easily manage that in your project."),(0,r.kt)("h3",{id:"whats-next"},"What's Next?"),(0,r.kt)("p",null,"In our next episode, we will do a lot of coding in ",(0,r.kt)("inlineCode",{parentName:"p"},"controller")," to create ",(0,r.kt)("inlineCode",{parentName:"p"},"weapon"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"armor"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"skill")," and equip a character with them. Controller is where you achieve most of your project functions and business logic. I am sure we will have a lot of fun in next episode."),(0,r.kt)("p",null,"In the meantime, you can learn more about LoopBack in ",(0,r.kt)("a",{parentName:"p",href:"https://strongloop.com/strongblog/tag_LoopBack.html"},"past blogs"),"."))}m.isMDXComponent=!0},2705:function(e,t,n){t.Z=n.p+"assets/images/my-first-api-p2-models-f5854d7c955356bd60e51ef60dbc2ba1.png"}}]);