<!DOCTYPE html>
<head>
    

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="The Elasticsearch connector enables LoopBack applications to connect to Elasticsearch data sources.">
  <meta name="keywords" content="community,  LoopBack">
  <title>Elastic Search connector | LoopBack Documentation</title>
  <link rel="stylesheet" href="/css/syntax.css">

    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/modern-business.css">
    <link rel="stylesheet" href="/css/lavish-bootstrap.css">
    <link rel="stylesheet" href="/css/customstyles.css">
    <link rel="stylesheet" href="/css/theme-v4.css">

    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150726441-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150726441-2');
</script>


    <!-- github star button -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>


    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.0/anchor.min.js"></script>
    <script src="/js/toc.js"></script>
    <script src="/js/customscripts.js"></script>

    <link rel="shortcut icon" href="/images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->


    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>

<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-lg navbar-brand no_icon" href="/doc/index.html">
              <img class="no_icon" style="width:147px;" src="/images/branding/logo/white/loopback.svg">&nbsp;<span class="projectTitle"></span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Docs<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is  -->
                          
                            <li><a href="https://loopback.io/doc/en/lb4/apidocs.index.html" target="_blank">LoopBack 4</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is  -->
                          
                            <li><a href="http://apidocs.loopback.io" target="_blank">LoopBack 3.x</a></li>
                          
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">View<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is / -->
                          
                            <li><a href="/">LoopBack Overview</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/en/lb4/ -->
                          
                            <li><a href="/doc/en/lb4/">LoopBack 4</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/en/lb3/ -->
                          
                            <li><a href="/doc/en/lb3/">LoopBack 3.x</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/en/lb2/ -->
                          
                            <li><a href="/doc/en/lb2/">LoopBack 2.x</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/en/community/ -->
                          
                            <li class="dropdownActive"><a href="/doc/en/community/">Community projects</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/en/contrib/ -->
                          
                            <li><a href="/doc/en/contrib/">Contributing to LoopBack</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/en/sec/ -->
                          
                            <li><a href="/doc/en/sec/">Security advisories</a></li>
                          
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Resources<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is  -->
                          
                            <li><a href="https://github.com/strongloop/loopback.io" target="_blank">Docs Github Repo</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is  -->
                          
                            <li><a href="https://groups.google.com/forum/#!forum/loopbackjs-announcements" target="_blank">Announcements Mailing List</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is  -->
                          
                            <li><a href="https://groups.google.com/forum/#!forum/loopbackjs" target="_blank">Developer Forum</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is  -->
                          
                            <li><a href="https://join.slack.com/t/loopbackio/shared_invite/zt-8lbow73r-SKAKz61Vdao~_rGf91pcsw" target="_blank">LoopBack on Slack</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is  -->
                          
                            <li><a href="https://stackoverflow.com/questions/tagged/strongloop+or+loopback4+or+loopbackjs" target="_blank">LoopBack on Stack Overflow</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is  -->
                          
                            <li><a href="https://strongloop.com/strongblog/tag_LoopBack.html" target="_blank">StrongLoop Blog - LoopBack</a></li>
                          
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Translations<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/es/lb2/ -->
                          
                            <li><a href="/doc/es/lb2/">Español (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/es/lb4/ -->
                          
                            <li><a href="/doc/es/lb4/">Español (v4)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/fr/lb2/ -->
                          
                            <li><a href="/doc/fr/lb2/">Français (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/fr/lb4/ -->
                          
                            <li><a href="/doc/fr/lb4/">Français (v4)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/ko/lb2/ -->
                          
                            <li><a href="/doc/ko/lb2/">한국어 (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/ko/lb3/ -->
                          
                            <li><a href="/doc/ko/lb3/">한국어 (v3)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/pt-br/lb2/ -->
                          
                            <li><a href="/doc/pt-br/lb2/">Português (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/pt-br/lb4/ -->
                          
                            <li><a href="/doc/pt-br/lb4/">Português (v4)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/ja/lb2/ -->
                          
                            <li><a href="/doc/ja/lb2/">日本語 (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/ja/lb3/ -->
                          
                            <li><a href="/doc/ja/lb3/">日本語 (v3)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/ja/lb4/ -->
                          
                            <li><a href="/doc/ja/lb4/">日本語 (v4)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/ru/lb2/ -->
                          
                            <li><a href="/doc/ru/lb2/">Pусский (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/zh/lb2/ -->
                          
                            <li><a href="/doc/zh/lb2/">中文 (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/en/community/Elasticsearch-connector.html .... folderitem.url is /doc/zh/lb4/ -->
                          
                            <li><a href="/doc/zh/lb4/">中文 (v4)</a></li>
                          
                        
                    </ul>
                </li>
                
                
                
                <li>
                    <form id="search" name="search" class="input-group lb-search" action="/search" method="GET">
                        <input type="text" class="form-control search-bar" placeholder="Search (powered by Watson)" name="q">
                        
                        <div class="input-group-btn">
                            <button type="submit" class="btn btn-default" aria-label="search">
                              <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                            </button>
                        </div>
                      </form>
                </li>
            </ul>
        </div>
      </div>
</nav>

<!-- Page Content -->
<div class="container">
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <nav class="col-md-3 sidebar-col">
          











<!-- NOTE: sidebar = site.data.sidebars.mydoc_sidebar.entries -->
<div class="sidebarTitle"><a href="index.html">Community projects</a></div>
<ul id="mysidebar" class="nav-list">
  

  
  
  <li class=" leaf-node  ">
    
    
      <a class="page-link" href="How-to-add-a-project.html">How to add a project</a>
    
      
  </li>
  


  
  
  <li class=" leaf-node  ">
    
    
      <a class="page-link" href="/doc/en/lb4/Community-extensions.html">LoopBack 4 community extensions</a>
    
      
  </li>
  


  
  
  <li class=" leaf-node  active">
    
    
      <a class="page-link" href="Elasticsearch-connector.html">Elasticsearch connector</a>
    
      
  </li>
  


  
  
  <li class=" leaf-node  ">
    
    
      <a class="page-link" href="SDK-builder.html">LoopBack SDK Builder</a>
    
      
  </li>
  


  
  
  <li class=" leaf-node  ">
    
    
      <a class="page-link" href="JSON-schemas.html">JSON Schemas</a>
    
      
  </li>
  


  
  
  <li class=" leaf-node  ">
    
    
      <a class="page-link" href="dynamo-connector.html">DynamoDB Connector</a>
    
      
  </li>
  


  
  
  <li class=" leaf-node  ">
    
    
      <a class="page-link" href="IoT-demo.html">IoT demo</a>
    
      
  </li>
  


  
  
  <li class=" leaf-node  ">
    
    
      <a class="page-link" href="SuperTest-models.html">SuperTest models</a>
    
      
  </li>
  


  
  
  <li class=" leaf-node  ">
    
    
      <a class="page-link" href="Declarative-test-demo.html">Declarative test demo</a>
    
      
  </li>
  



</ul>

        </nav>
        <!-- Content Column -->
        <div class="col-md-9">
            
<div class="post-header">
   <h1 class="post-title-main">Elastic Search connector</h1>
   
</div>

<div class="post-content">


  
   <div class="summary">
     The Elasticsearch connector enables LoopBack applications to connect to Elasticsearch data sources.
   </div>
  




 

    <style>
h1:not(.post-title-main) { display: none; }
</style>

  

  
  

  
  <div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i>
    <b>Note:</b> This page was generated from the
    <a href="https://github.com/strongloop-community/loopback-connector-elastic-search">loopback-connector-elastic-search/README.md</a>.
  </div>

  


  
  
<h1 id="loopback-connector-elastic-search">loopback-connector-elastic-search</h1>

<p><a href="https://gitter.im/strongloop-community/loopback-connector-elastic-search?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Join the chat at https://gitter.im/strongloop-community/loopback-connector-elastic-search" /></a></p>

<p>Elasticsearch(versions 6.x and 7.x) datasource connector for <a href="https://loopback.io/">Loopback 3.x</a>.</p>

<h1 id="table-of-contents">Table of Contents</h1>

<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#install-this-connector-in-your-loopback-app">Install this connector in your loopback app</a></li>
  <li><a href="#configuring-connector">Configuring connector</a>
    <ul>
      <li><a href="#required">Required properties</a></li>
      <li><a href="#recommended">Recommended properties</a></li>
      <li><a href="#optional">Optional properties</a></li>
      <li><a href="#sample">Sample for copy paste</a></li>
    </ul>
  </li>
  <li><a href="#elasticsearch-searchafter-support">Elasticsearch SearchAfter Support</a></li>
  <li><a href="#totalcount-support-for-search">TotalCount Support for search</a></li>
  <li><a href="#about-the-example-app">Example</a></li>
  <li><a href="#troubleshooting">Troubleshooting</a></li>
  <li><a href="#contributing">Contributing</a></li>
  <li><a href="#faqs">Frequently Asked Questions</a></li>
</ul>

<h2 id="overview">Overview</h2>

<ol>
  <li><code class="language-plaintext highlighter-rouge">lib</code> directory has the entire source code for this connector
    <ol>
      <li>this is what gets downloaded to your <code class="language-plaintext highlighter-rouge">node_modules</code> folder when you run <code class="language-plaintext highlighter-rouge">npm install loopback-connector-esv6 --save --save-exact</code></li>
    </ol>
  </li>
  <li><code class="language-plaintext highlighter-rouge">examples</code> directory has a loopback app which uses this connector
    <ol>
      <li>this is not published to NPM, it is only here for demo purposes
        <ol>
          <li>it will not be downloaded to your <code class="language-plaintext highlighter-rouge">node_modules</code> folder!</li>
          <li>similarly the <code class="language-plaintext highlighter-rouge">examples/server/datasources.json</code> file is there for this demo app to use</li>
          <li>you can copy their content over to <code class="language-plaintext highlighter-rouge">&lt;yourApp&gt;/server/datasources.json</code> or <code class="language-plaintext highlighter-rouge">&lt;yourApp&gt;/server/datasources.&lt;env&gt;.js</code> if you want and edit it there but don’t start editing the files inside <code class="language-plaintext highlighter-rouge">examples/server</code> itself and expect changes to take place in your app!</li>
        </ol>
      </li>
    </ol>
  </li>
  <li><code class="language-plaintext highlighter-rouge">test</code> directory has unit tests
    <ol>
      <li>it does not reuse the loopback app from the <code class="language-plaintext highlighter-rouge">examples</code> folder</li>
      <li>instead, loopback and ES/datasource are built and injected programatically</li>
      <li>this directory is not published to NPM.
        <ol>
          <li>Refer to <code class="language-plaintext highlighter-rouge">.npmignore</code> if you’re still confused about what’s part of the <em>published</em> connector and what’s not.</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>You will find the <code class="language-plaintext highlighter-rouge">datasources.json</code> files in this repo mention various configurations:
    <ol>
      <li><code class="language-plaintext highlighter-rouge">elasticsearch-ssl</code></li>
      <li><code class="language-plaintext highlighter-rouge">elasticsearch-plain</code></li>
      <li><code class="language-plaintext highlighter-rouge">db</code></li>
      <li>You don’t need them all! They are just examples to help you see the various ways in which you can configure a datasource. Delete the ones you don’t need and keep the one you want. For example, most people will start off with <code class="language-plaintext highlighter-rouge">elasticsearch-plain</code> and then move on to configuring the additional properties that are exemplified in <code class="language-plaintext highlighter-rouge">elasticsearch-ssl</code>. You can mix &amp; match if you’d like to have mongo and es and memory, all three! These are basics of the “connector” framework in loooback and not something we added.</li>
    </ol>
  </li>
  <li>Don’t forget to edit your <code class="language-plaintext highlighter-rouge">model-config.json</code> file and point the models at the <code class="language-plaintext highlighter-rouge">dataSource</code> you want to use.</li>
</ol>

<h2 id="install-this-connector-in-your-loopback-app">Install this connector in your loopback app</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> &lt;yourApp&gt;
npm <span class="nb">install </span>loopback-connector-esv6 <span class="nt">--save</span> <span class="nt">--save-exact</span>
</code></pre></div></div>

<h2 id="configuring-connector">Configuring connector</h2>

<h3 id="important-note">Important Note</h3>

<ul>
  <li><strong>This connector will only connect to one index per datasource.</strong></li>
  <li>This package is created to support ElasticSearch v6.x and 7.x only.</li>
  <li><code class="language-plaintext highlighter-rouge">docType</code> property is automatically added in mapping properties which is required to differentiate documents stored in index with loopback model data. It stores loopback modelName value. <code class="language-plaintext highlighter-rouge">docType: { type: "keyword", index: true }</code></li>
</ul>

<h3 id="required">Required</h3>

<ul>
  <li><strong>name:</strong> name of the connector.</li>
  <li><strong>connector:</strong> Elasticsearch driver <strong>‘esv6’</strong>.</li>
  <li><strong>configuration:</strong> Elasticsearch client configuraiton object which includes nodes, authetication and ssl coonfiguration. Please refer this <a href="https://www.elastic.co/guide/en/elasticsearch/client/javascript-api/current/client-configuration.html">official link</a> for more information on configuraiton.</li>
  <li><strong>index:</strong> Name of the ElasticSearch index <code class="language-plaintext highlighter-rouge">eg: shakespeare</code>.</li>
  <li><strong>version:</strong> specify the major version of the Elasticsearch nodes you will be connecting to. Supported versions: [6, 7] <code class="language-plaintext highlighter-rouge">eg: version: 7</code></li>
  <li><strong>mappingType:</strong> mapping type for provided index. defaults to <code class="language-plaintext highlighter-rouge">basedata</code>. Required only for version: 6</li>
  <li><strong>mappingProperties:</strong> An object with properties for above mentioned <code class="language-plaintext highlighter-rouge">mappingType</code></li>
</ul>

<h3 id="optional">Optional</h3>

<ul>
  <li><strong>indexSettings:</strong> optional settings object for creating index.</li>
  <li><strong>defaultSize:</strong> Search size limit. Default is 50.</li>
</ul>

<h3 id="sample">Sample</h3>

<p>1.Edit <strong>datasources.json</strong> and set:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
  <span class="dl">"</span><span class="s2">elastic-search-ssl</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">elasticsearch-example-index-datasource</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">connector</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">esv6</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">version</span><span class="dl">"</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">example-index</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">configuration</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span> <span class="c1">// Elastic client configuration</span>
    <span class="dl">"</span><span class="s2">node</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://localhost:9200</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">requestTimeout</span><span class="dl">"</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">pingTimeout</span><span class="dl">"</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">auth</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">ssl</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">rejectUnauthorized</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">defaultSize</span><span class="dl">"</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">indexSettings</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span> <span class="c1">// Elastic index settings</span>
    <span class="dl">"</span><span class="s2">number_of_shards</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">number_of_replicas</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">mappingType</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">basedata</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// not required for verison: 7, will be ignored</span>
  <span class="dl">"</span><span class="s2">mappingProperties</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">docType</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">seq</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">integer</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">birthday</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">role</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">order</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">integer</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">vip</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">boolean</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">objectId</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">keyword</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">ttl</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">integer</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="dl">"</span><span class="s2">created</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">date</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>2.You can peek at <code class="language-plaintext highlighter-rouge">/examples/server/datasources.json</code> for more hints.</p>

<h2 id="elasticsearch-searchafter-support">Elasticsearch SearchAfter Support</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">search_after</code> feature of elasticsearch is supported in loopback filter.</li>
  <li>For this, you need to create a property in model called <code class="language-plaintext highlighter-rouge">_search_after</code> with loopback type <code class="language-plaintext highlighter-rouge">["any"]</code>. This field cannot be updated using in connector.</li>
  <li>Elasticsearch <code class="language-plaintext highlighter-rouge">sort</code> value will return in this field.</li>
  <li>You need pass <code class="language-plaintext highlighter-rouge">_search_after</code> value in <code class="language-plaintext highlighter-rouge">searchafter</code> key of loopback filter.</li>
  <li>Example filter query for <code class="language-plaintext highlighter-rouge">find</code>.</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"where"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hello"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"created DESC"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"searchafter"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="mi">1580902552905</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"limit"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>Example result.</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1bb2dd63-c7b9-588e-a942-15ca4f891a80"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"_search_after"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">1580902552905</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-02-05T11:35:52.905Z"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fd5ea4df-f159-5816-9104-22147f2a740f"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"_search_after"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">1580902552901</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-02-05T11:35:52.901Z"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"047c0adb-13ea-5f80-a772-3d2a4691d47a"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test4"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"_search_after"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">1580902552897</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-02-05T11:35:52.897Z"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<ul>
  <li>This is useful for pagination. To go to previous page, change sorting order.</li>
</ul>

<h2 id="totalcount-support-for-search">TotalCount Support for search</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">total</code> value from elasticsearch for search queries is now supported in loopback response.</li>
  <li>For this, you need to create a property in model called <code class="language-plaintext highlighter-rouge">_total_count</code> with loopback type <code class="language-plaintext highlighter-rouge">"number"</code>. This field cannot be updated using in connector.</li>
  <li>Example response <code class="language-plaintext highlighter-rouge">find</code>.</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1bb2dd63-c7b9-588e-a942-15ca4f891a80"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"_search_after"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">1580902552905</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"_total_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-02-05T11:35:52.905Z"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fd5ea4df-f159-5816-9104-22147f2a740f"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"_search_after"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">1580902552901</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"_total_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-02-05T11:35:52.901Z"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"047c0adb-13ea-5f80-a772-3d2a4691d47a"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test4"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"_search_after"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="mi">1580902552897</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"_total_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="nl">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-02-05T11:35:52.897Z"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<h2 id="about-the-example-app">About the example app</h2>

<ol>
  <li>The <code class="language-plaintext highlighter-rouge">examples</code> directory contains a loopback app which uses this connector.</li>
  <li>You can point this example at your own elasticsearch instance or use the quick instances provided via docker.</li>
</ol>

<h2 id="troubleshooting">Troubleshooting</h2>

<ol>
  <li>Do you have both <code class="language-plaintext highlighter-rouge">elasticsearch-ssl</code> and <code class="language-plaintext highlighter-rouge">elasticsearch-plain</code> in your <code class="language-plaintext highlighter-rouge">datasources.json</code> file? You just need one of them (not both), based on how you’ve setup your ES instance.</li>
  <li>Did you forget to set <code class="language-plaintext highlighter-rouge">model-config.json</code> to point at the datasource you configured? Maybe you are using a different or misspelled name than what you thought you had!</li>
  <li>Make sure to configure major version of Elastic in <code class="language-plaintext highlighter-rouge">version</code></li>
  <li>Maybe the version of ES you are using isn’t supported by the client that this project uses. Try removing the <code class="language-plaintext highlighter-rouge">elasticsearch</code> sub-dependency from <code class="language-plaintext highlighter-rouge">&lt;yourApp&gt;/node_modules/loopback-connector-esv6/node_modules</code> folder and then install the latest client:
    <ol>
      <li><code class="language-plaintext highlighter-rouge">cd &lt;yourApp&gt;/node_modules/loopback-connector-esv6/node_modules</code></li>
      <li>then remove <code class="language-plaintext highlighter-rouge">es6</code> &amp;&amp; <code class="language-plaintext highlighter-rouge">es7</code> folder
        <ol>
          <li>unix/mac quickie: <code class="language-plaintext highlighter-rouge">rm -rf es6 es7</code></li>
        </ol>
      </li>
      <li><code class="language-plaintext highlighter-rouge">npm install</code></li>
      <li>go back to yourApp’s root directory
        <ol>
          <li>unix/mac quickie: <code class="language-plaintext highlighter-rouge">cd &lt;yourApp&gt;</code></li>
        </ol>
      </li>
      <li>And test that you can now use the connector without any issues!</li>
      <li>These changes can easily get washed away for several reasons. So for a more permanent fix that adds the version you want to work on into a release of this connector, please look into <a href="#contributing">Contributing</a>.</li>
    </ol>
  </li>
</ol>

<h2 id="contributing">Contributing</h2>

<ol>
  <li>Feel free to <a href="https://github.com/strongloop-community/loopback-connector-elastic-search/pulls">contribute via PR</a> or <a href="https://github.com/strongloop-community/loopback-connector-elastic-search/issues">open an issue</a> for discussion or jump into the <a href="https://gitter.im/strongloop-community/loopback-connector-elastic-search">gitter chat room</a> if you have ideas.</li>
  <li>I recommend that project contributors who are part of the team:
    <ol>
      <li>should merge <code class="language-plaintext highlighter-rouge">master</code> into <code class="language-plaintext highlighter-rouge">develop</code> … if they are behind, before starting the <code class="language-plaintext highlighter-rouge">feature</code> branch</li>
      <li>should create <code class="language-plaintext highlighter-rouge">feature</code> branches from the <code class="language-plaintext highlighter-rouge">develop</code> branch</li>
      <li>should merge <code class="language-plaintext highlighter-rouge">feature</code> into <code class="language-plaintext highlighter-rouge">develop</code> then create a <code class="language-plaintext highlighter-rouge">release</code> branch to:
        <ol>
          <li>update the changelog</li>
          <li>close related issues and mention release version</li>
          <li>update the readme</li>
          <li>fix any bugs from final testing</li>
          <li>commit locally and run <code class="language-plaintext highlighter-rouge">npm-release x.x.x -m "&lt;some comment&gt;"</code></li>
          <li>merge <code class="language-plaintext highlighter-rouge">release</code> into both <code class="language-plaintext highlighter-rouge">master</code> and <code class="language-plaintext highlighter-rouge">develop</code></li>
          <li>push <code class="language-plaintext highlighter-rouge">master</code> and <code class="language-plaintext highlighter-rouge">develop</code> to GitHub</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>For those who use forks:
    <ol>
      <li>please submit your PR against the <code class="language-plaintext highlighter-rouge">develop</code> branch, if possible</li>
      <li>if you must submit your PR against the <code class="language-plaintext highlighter-rouge">master</code> branch … I understand and I can’t stop you. I only hope that there is a good reason like <code class="language-plaintext highlighter-rouge">develop</code> not being up-to-date with <code class="language-plaintext highlighter-rouge">master</code> for the work you want to build upon.</li>
    </ol>
  </li>
  <li><code class="language-plaintext highlighter-rouge">npm-release &lt;versionNumber&gt; -m &lt;commit message&gt;</code> may be used to publish. Pubilshing to NPM should happen from the <code class="language-plaintext highlighter-rouge">master</code> branch. It should ideally only happen when there is something release worthy. There’s no point in publishing just because of changes to <code class="language-plaintext highlighter-rouge">test</code> or <code class="language-plaintext highlighter-rouge">examples</code> folder or any other such entities that aren’t part of the “published module” (refer to <code class="language-plaintext highlighter-rouge">.npmignore</code>) to begin with.</li>
</ol>

<h2 id="faqs">FAQs</h2>

<ol>
  <li>How do we enable or disable the logs coming from the underlying elasticsearch client? There may be a need to debug/troubleshoot at times.
    <ol>
      <li>Use the env variable <code class="language-plaintext highlighter-rouge">DEBUG=elasticsearch</code> for elastic client logs.</li>
    </ol>
  </li>
  <li>How do we enable or disable the logs coming from this connector?
    <ol>
      <li>By default if you do not set the following env variable, they are disabled: <code class="language-plaintext highlighter-rouge">DEBUG=loopback:connector:elasticsearch</code></li>
    </ol>
  </li>
  <li>What are the tests about? Can you provide a brief overview?
    <ol>
      <li>Tests are prefixed with <code class="language-plaintext highlighter-rouge">01</code> or <code class="language-plaintext highlighter-rouge">02</code> etc. in order to run them in that order by leveraging default alphabetical sorting.</li>
      <li>The <code class="language-plaintext highlighter-rouge">02.basic-querying.test.js</code> file uses two models to test various CRUD operations that any connector must provide, like <code class="language-plaintext highlighter-rouge">find(), findById(), findByIds(), updateAttributes()</code> etc.
        <ol>
          <li>the two models are <code class="language-plaintext highlighter-rouge">User</code> and <code class="language-plaintext highlighter-rouge">Customer</code></li>
          <li>their ES <em>mappings</em> are laid out in <code class="language-plaintext highlighter-rouge">test/resource/datasource-test.json</code></li>
          <li>their loopback <em>definitions</em> can be found in the first <code class="language-plaintext highlighter-rouge">before</code> block that performs setup in <code class="language-plaintext highlighter-rouge">02.basic-querying.test.js</code> file … these are the equivalent of a <code class="language-plaintext highlighter-rouge">MyModel.json</code> in your real loopback app.
            <ol>
              <li>naturally, this is also where we define which property serves as the <code class="language-plaintext highlighter-rouge">id</code> for the model and if its <a href="https://docs.strongloop.com/display/APIC/Model+definition+JSON+file#ModeldefinitionJSONfile-IDproperties">generated</a> or not</li>
            </ol>
          </li>
        </ol>
      </li>
    </ol>
  </li>
  <li>How do we get elasticserch to take over ID generation?
    <ol>
      <li>An automatically generated id-like field that is maintained by ES is <code class="language-plaintext highlighter-rouge">_id</code>. Without some sort of es-field-level-scripting-on-index (if that is possible at all) … I am not sure how we could ask elasticsearch to take over auto-generating an id-like value for any arbitrary field! So the connector is setup such that adding <code class="language-plaintext highlighter-rouge">id: {type: String, generated: true, id: true}</code> will tell it to use <code class="language-plaintext highlighter-rouge">_id</code> as the actual field backing the <code class="language-plaintext highlighter-rouge">id</code> … you can keep using the doing <code class="language-plaintext highlighter-rouge">model.id</code> abstraction and in the background <code class="language-plaintext highlighter-rouge">_id</code> values are mapped to it.</li>
      <li>Will this work for any field marked as with <code class="language-plaintext highlighter-rouge">generated: true</code> and <code class="language-plaintext highlighter-rouge">id: true</code>?
        <ol>
          <li>No! The connector isn’t coded that way right now … while it is an interesting idea to couple any such field with ES’s <code class="language-plaintext highlighter-rouge">_id</code> field inside this connector … I am not sure if this is the right thing to do. If you had <code class="language-plaintext highlighter-rouge">objectId: {type: String, generated: true, id: true}</code> then you won’t find a real <code class="language-plaintext highlighter-rouge">objectId</code> field in your ES documents. Would that be ok? Wouldn’t that confuse developers who want to write custom queries and run 3rd party app against their ES instance? Don’t use <code class="language-plaintext highlighter-rouge">objectId</code>, use <code class="language-plaintext highlighter-rouge">_id</code> would have to be common knowledge. Is that ok?</li>
        </ol>
      </li>
    </ol>
  </li>
</ol>




    <div class="tags">
      
        <b>Tags: </b>
        
        
          
            <a href="tag_community.html" class="tags-item" role="button">community</a>
            
        
      
    </div>
</div>

<hr class="shaded"/>

<footer id="container">
            <div class="row">
                <div class="col-md-6 footer-left">
               &copy;2021 IBM / StrongLoop. All rights reserved. <br />
 Site last generated: Mar 22, 2021
              </div>
              <div class="col-md-6 footer-right">
                <p><img src="https://loopback.io/images/company_logo.png" alt="Company logo"/></p>
              </div>
            </div>
</footer>


        </div>
        <!-- /.row -->
</div>
<!-- /.container -->
    </div>
</body>

</html>
