<!DOCTYPE html>
<head>
    

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="操作フックは、作成・読取・更新・削除に関する高レベルの操作を実行するすべてのメソッドによって起動されます。LoopBackバージョン3.0の操作フックには多くの変更が加えられました。">
  <meta name="keywords" content="application_logic,  LoopBack">
  <title>操作フック | LoopBack Documentation</title>
  <link rel="stylesheet" href="/css/syntax.css">

    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/modern-business.css">
    <link rel="stylesheet" href="/css/lavish-bootstrap.css">
    <link rel="stylesheet" href="/css/customstyles.css">
    <link rel="stylesheet" href="/css/theme-v4.css">

    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150726441-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150726441-2');
</script>


    <!-- github star button -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>


    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.0/anchor.min.js"></script>
    <script src="/js/toc.js"></script>
    <script src="/js/customscripts.js"></script>

    <link rel="shortcut icon" href="/images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->


    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>

<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-lg navbar-brand no_icon" href="/doc/index.html">
              <img class="no_icon" style="width:147px;" src="/images/branding/logo/white/loopback.svg">&nbsp;<span class="projectTitle"></span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Docs<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is  -->
                          
                            <li><a href="https://loopback.io/doc/en/lb4/apidocs.index.html" target="_blank">LoopBack 4</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is  -->
                          
                            <li><a href="http://apidocs.loopback.io" target="_blank">LoopBack 3.x</a></li>
                          
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">View<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is / -->
                          
                            <li><a href="/">LoopBack Overview</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/en/lb4/ -->
                          
                            <li><a href="/doc/en/lb4/">LoopBack 4</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/en/lb3/ -->
                          
                            <li><a href="/doc/en/lb3/">LoopBack 3.x</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/en/lb2/ -->
                          
                            <li><a href="/doc/en/lb2/">LoopBack 2.x</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/en/community/ -->
                          
                            <li><a href="/doc/en/community/">Community projects</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/en/contrib/ -->
                          
                            <li><a href="/doc/en/contrib/">Contributing to LoopBack</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/en/sec/ -->
                          
                            <li><a href="/doc/en/sec/">Security advisories</a></li>
                          
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Resources<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is  -->
                          
                            <li><a href="https://github.com/strongloop/loopback.io" target="_blank">Docs Github Repo</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is  -->
                          
                            <li><a href="https://groups.google.com/forum/#!forum/loopbackjs-announcements" target="_blank">Announcements Mailing List</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is  -->
                          
                            <li><a href="https://groups.google.com/forum/#!forum/loopbackjs" target="_blank">Developer Forum</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is  -->
                          
                            <li><a href="https://join.slack.com/t/loopbackio/shared_invite/zt-8lbow73r-SKAKz61Vdao~_rGf91pcsw" target="_blank">LoopBack on Slack</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is  -->
                          
                            <li><a href="https://stackoverflow.com/questions/tagged/strongloop+or+loopback4+or+loopbackjs" target="_blank">LoopBack on Stack Overflow</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is  -->
                          
                            <li><a href="https://strongloop.com/strongblog/tag_LoopBack.html" target="_blank">StrongLoop Blog - LoopBack</a></li>
                          
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Translations<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/es/lb2/ -->
                          
                            <li><a href="/doc/es/lb2/">Español (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/es/lb4/ -->
                          
                            <li><a href="/doc/es/lb4/">Español (v4)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/fr/lb2/ -->
                          
                            <li><a href="/doc/fr/lb2/">Français (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/fr/lb4/ -->
                          
                            <li><a href="/doc/fr/lb4/">Français (v4)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/ko/lb2/ -->
                          
                            <li><a href="/doc/ko/lb2/">한국어 (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/ko/lb3/ -->
                          
                            <li><a href="/doc/ko/lb3/">한국어 (v3)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/pt-br/lb2/ -->
                          
                            <li><a href="/doc/pt-br/lb2/">Português (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/pt-br/lb4/ -->
                          
                            <li><a href="/doc/pt-br/lb4/">Português (v4)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/ja/lb2/ -->
                          
                            <li><a href="/doc/ja/lb2/">日本語 (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/ja/lb3/ -->
                          
                            <li class="dropdownActive"><a href="/doc/ja/lb3/">日本語 (v3)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/ja/lb4/ -->
                          
                            <li><a href="/doc/ja/lb4/">日本語 (v4)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/ru/lb2/ -->
                          
                            <li><a href="/doc/ru/lb2/">Pусский (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/zh/lb2/ -->
                          
                            <li><a href="/doc/zh/lb2/">中文 (v2)</a></li>
                          
                        
                        <!-- page.url is /doc/ja/lb3/Operation-hooks.html .... folderitem.url is /doc/zh/lb4/ -->
                          
                            <li><a href="/doc/zh/lb4/">中文 (v4)</a></li>
                          
                        
                    </ul>
                </li>
                
                
                
                <li>
                    <form id="search" name="search" class="input-group lb-search" action="/search" method="GET">
                        <input type="text" class="form-control search-bar" placeholder="Search (powered by Watson)" name="q">
                        
                          <input type="hidden" name="sidebar" value="ja_lb3_sidebar">
                        
                        <div class="input-group-btn">
                            <button type="submit" class="btn btn-default" aria-label="search">
                              <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                            </button>
                        </div>
                      </form>
                </li>
            </ul>
        </div>
      </div>
</nav>

<!-- Page Content -->
<div class="container">
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <nav class="col-md-3 sidebar-col">
          











<!-- NOTE: sidebar = site.data.sidebars.mydoc_sidebar.entries -->
<div class="sidebarTitle"><a href="/doc/ja/lb3/index.html">LoopBack 3.x</a></div>
<ul id="mysidebar" class="nav-list">
  

  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Installation.html">インストール</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Installation-troubleshooting.html">Installation troubleshooting</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="3.0-Release-Notes.html">3.0 Release Notes</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Migrating-to-3.0.html">Migrating apps to v3</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="LoopBack-core-concepts.html">LoopBackの核となる概念</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Routing.html">ルーティング</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="LoopBack-FAQ.html">LoopBack FAQ</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Glossary.html">用語集</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="StrongLoop-Labs.html">StrongLoop Labs</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Getting-started-with-LoopBack.html">LoopBack を始めよう</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Create-a-simple-API.html">Create a simple API</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Use-API-Explorer.html">Use API Explorer</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Connect-your-API-to-a-data-source.html">Connect your API to a data source</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Extend-your-API.html">Extend your API</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Add-a-static-web-page.html">Add a static web page</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Add-a-custom-Express-route.html">Add a custom Express route</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Next-steps.html">Next steps</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Getting-started-part-II.html">Getting started part II</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Introducing-the-Coffee-Shop-Reviews-app.html">Introducing the Coffee Shop Reviews app</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Create-new-data-source.html">Create new data source</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Create-new-models.html">Create new models</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Define-model-relations.html">Define model relations</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Define-access-controls.html">Define access controls</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Define-a-remote-hook.html">Define a remote hook</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Create-AngularJS-client.html">Create AngularJS client</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Learn-more.html">Learn more</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Tutorials-and-examples.html">Tutorials and examples</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Security-advisories.html">Security advisories</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Security-advisory-10-24-2017.html">10-24-2017</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Security-advisory-09-21-2017.html">09-21-2017</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Security-advisory-03-10-2017.html">03-10-2017</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Creating-an-application.html">アプリケーションの作成</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Environment-specific-configuration.html">環境別の設定</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Versioning-your-API.html">APIのバージョニング</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Standard-project-structure.html">標準的なプロジェクト構成</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Defining-data-sources.html">Defining data sources</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Creating-a-database-schema-from-models.html">Creating a database schema from models</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Advanced-topics-data-sources.html">Data sources: advanced topics</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Using-database-transactions.html">データベースのトランザクションを使用する</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Executing-native-SQL.html">Executing native SQL</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Building-a-connector.html">Building a connector</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Implementing-create-retrieve-update-and-delete-methods.html">Implementing CRUD methods</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Implementing-model-discovery.html">Implementing model discovery</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Implementing-auto-migration.html">Implementing auto-migration</a>
      
  </li>
  



      </ul>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Defining-models.html">Defining models</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Using-the-model-generator.html">Using the model generator</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Discovering-models-from-relational-databases.html">リレーショナルデータベースからモデルを発見する</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Creating-models-from-unstructured-data.html">Creating models from unstructured data</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Customizing-models.html">モデルのカスタマイズ</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Exposing-models-over-REST.html">REST経由でモデルを公開する</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Validating-model-data.html">モデルのデータを検証する</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Creating-model-relations.html">Creating model relations</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Tutorial-model-relations.html">Tutorial: model relations</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="BelongsTo-relations.html">BelongsTo relations</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="HasOne-relations.html">HasOne relations</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="HasMany-relations.html">HasMany relations</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="HasManyThrough-relations.html">HasManyThrough relations</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="HasAndBelongsToMany-relations.html">HasAndBelongsToMany relations</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Polymorphic-relations.html">Polymorphic relations</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Querying-related-models.html">Querying related models</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Embedded-models-and-relations.html">Embedded models and relations</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Nested-queries.html">Nested queries</a>
      
  </li>
  



      </ul>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Using-built-in-models.html">Using built-in models</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Extending-built-in-models.html">Extending built-in models</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Adding-remote-methods-to-built-in-models.html">Adding remote methods to built-in models</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Model-property-reference.html">Model property reference</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Built-in-models-REST-API.html">Built-in models REST API</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="PersistedModel-REST-API.html">PersistedModel REST API</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Access-token-REST-API.html">Access token REST API</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="ACL-REST-API.html">ACL REST API</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Application-REST-API.html">Application REST API</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Relation-REST-API.html">Relation REST API</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Role-REST-API.html">Role REST API</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="User-REST-API.html">User REST API</a>
      
  </li>
  



      </ul>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Attaching-models-to-data-sources.html">Attaching models to data sources</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Managing-users.html">Managing users</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Registering-users.html">Registering users</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Logging-in-users.html">Logging in users</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Partitioning-users-with-realms.html">Partitioning users with realms</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="User-management-example.html">User management example</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Authentication-authorization-and-permissions.html">認証・認可・パーミッション</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Introduction-to-User-model-authentication.html">Introduction to User model authentication</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Controlling-data-access.html">Controlling data access</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Making-authenticated-requests.html">Making authenticated requests</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Defining-and-using-roles.html">Defining and using roles</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Accessing-related-models.html">Accessing related models</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Creating-a-default-admin-user.html">Creating a default admin user</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Security-considerations.html">Security considerations</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Tutorial-access-control.html">Tutorial: access control</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Working-with-data.html">データの操作</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Creating-updating-and-deleting-data.html">データの作成・更新・削除</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Querying-data.html">データの検索</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Fields-filter.html">Fields フィルタ</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Include-filter.html">Include フィルタ</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Limit-filter.html">Limit フィルタ</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Order-filter.html">Order フィルタ</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Skip-filter.html">Skip フィルタ</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Where-filter.html">Where フィルタ</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Advanced-topics-data.html">Advanced topics: data</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Realtime-server-sent-events.html">Realtime server-sent events</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="AngularJS-LiveSet.html">AngularJS Live Set</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="AngularJS-LiveSet-Example.html">AngularJS Live Set example</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Realtime-socket-io.html">Real-time apps AngularJS using socket.io</a>
      
  </li>
  



      </ul>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Adding-application-logic.html">アプリケーションロジックの追加</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Working-with-LoopBack-objects.html">LoopBackのオブジェクトを扱う</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Adding-logic-to-models.html">モデルにロジックを追加する</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Remote-methods.html">リモートメソッド</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Remote-hooks.html">リモートフック</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Operation-hooks.html">操作フック</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Connector-hooks.html">コネクタフック</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Tutorial-Adding-application-logic.html">Tutorial: Application logic</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Defining-boot-scripts.html">起動スクリプトの定義</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Defining-mixins.html">Defining mixins</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Defining-middleware.html">Defining middleware</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Middleware-example.html">Middleware example</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Using-current-context.html">Using current context</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Events.html">Events</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Using-promises.html">Using promises</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Running-and-debugging-apps.html">アプリケーションの実行とデバッグ</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Setting-debug-strings.html">デバッグ文字列の設定</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Using-strong-error-handler.html">Using strong-error-handler</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Preparing-for-deployment.html">Preparing for deployment</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="LoopBack-on-Bluemix.html">Running LoopBack apps on Bluemix</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="LoopBack-components.html">LoopBack components</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="OAuth-2.0.html">OAuth 2.0 component</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Push-notifications.html">Push notification component</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Push-notifications-for-iOS-apps.html">Push notifications for iOS apps</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Push-notifications-for-Android-apps.html">Push notifications for Android apps</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Storage-component.html">Storage component</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Storage-component-REST-API.html">Storage component REST API</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Storage-example.html">Storage component example</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Third-party-login-using-Passport.html">Passport login component</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Configuring-providers.json.html">Configuring providers.json</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Tutorial-third-party-login.html">Tutorial: third-party login</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Synchronization.html">Synchronization component</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Tutorial-Offline-Synchronization.html">Tutorial: Offline Synchronization</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Advanced-topics-sync.html">Advanced topics - sync</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Creating-components.html">Creating components</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Command-line-tools.html">コマンドラインツール</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="ACL-generator.html">ACL generator</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="API-definition-generator.html">API 定義生成ツール</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Application-generator.html">Application generator</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Bluemix-config-generator.html">Bluemix configuration generator</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Boot-script-generator.html">Boot script generator</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Data-source-generator.html">Data source generator</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Middleware-generator.html">Middleware generator</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Model-generator.html">Model generator</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Oracle-installer-command.html">Oracle installer command</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Property-generator.html">Property generator</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Refresh-definitions-command.html">Refresh definitions command</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Relation-generator.html">Relation generator</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Remote-method-generator.html">Remote method generator</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="SOAP-generator.html">SOAP generator</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Swagger-generator.html">Swagger 生成ツール</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Client-SDKs.html">Client SDKs</a>
      
      <ul class="nav-list">
          

  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="iOS-SDK.html">iOS SDK</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="IOS-getting-started.html">Getting started with the iOS SDK</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Android-SDK.html">Android SDK</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Tutorial-android-getting-started.html">Getting started with the Android SDK</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Working-with-files-using-the-Android-SDK.html">Working with files using the Android SDK</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Push-notifications-using-Android-SDK.html">Push notifications using Android SDK</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Working-with-the-LocalInstallation-class.html">Working with the LocalInstallation class</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="AngularJS-JavaScript-SDK.html">AngularJS SDK</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Angular-example-app.html">Angular example app</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="AngularJS-Grunt-plugin.html">AngularJS Grunt plugin</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Xamarin-SDK.html">Xamarin SDK</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Xamarin-client-API.html">Xamarin client API</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Xamarin-example-app.html">Xamarin example app</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="LoopBack-in-the-client.html">Isomorphic LoopBack</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Running-LoopBack-in-the-browser.html">Running LoopBack in the browser</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Using-Browserify.html">Using Browserify</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Isomorphic-LoopBack-example.html">Isomorphic example</a>
      
  </li>
  



      </ul>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Connectors-reference.html">Connectors reference</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Memory-connector.html">Memory connector</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Database-connectors.html">Database connectors</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Cassandra-connector.html">Cassandra connector</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Cloudant-connector.html">Cloudant connector</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="DashDB.html">DashDB</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="DB2-connector.html">DB2 connector</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="DB2-iSeries-connector.html">DB2 for iSeries connector</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="DB2-for-z-OS.html">DB2 for z/OS</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Informix.html">Informix connector</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="MongoDB-connector.html">MongoDB connector</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Connecting-to-MongoDB.html">MongoDB Connector Tutorial</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Using-MongoLab.html">Using MongoLab</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="MySQL-connector.html">MySQL connector</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Connecting-to-MySQL.html">MySQL Connector Tutorial</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Oracle-connector.html">Oracle connector</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Installing-the-Oracle-connector.html">Installing the Oracle connector</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Connecting-to-Oracle.html">Oracle connector tutorial</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="PostgreSQL-connector.html">PostgreSQL connector</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Connecting-to-PostgreSQL.html">PostgreSQL connector tutorial</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Redis-connector.html">Redis connector</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="kv-redis-connector.html">Redis key-value connector</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Example-kv-connector.html">KV connector example</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="SQL-Server-connector.html">SQL Server connector</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Connecting-to-Microsoft-SQL-Server.html">SQL Server connector tutorial</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="SQLite3.html">SQLite3 connector</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Other-connectors.html">Other connectors</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Email-connector.html">Email connector</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="JSON-RPC-connector.html">JSON RPC connector</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="MQLight-connector.html">MQ Light connector</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Push-connector.html">Push connector</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Remote-connector.html">Remote connector</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Remote-connector-example.html">Remote connector example</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Strong-Remoting.html">Strong Remoting</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="REST-connector.html">REST connector</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="REST-connector-example.html">REST connector example</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="SOAP-connector.html">SOAP connector</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Strong-soap.html">Strong-soap</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="SOAP-Connector-example.html">SOAP connector example</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Connecting-to-SOAP.html">Connecting to SOAP web services</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Storage-connector.html">Storage connector</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Swagger-connector.html">Swagger connector</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Community-connectors.html">Community connectors</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Project-layout-reference.html">Project layout reference</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="client-directory.html">client directory</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="common-directory.html">common directory</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Model-definition-JSON-file.html">Model definition JSON file</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Model-extension-file.html">Model extension file</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="package.json.html">package.json</a>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="server-directory.html">server directory</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="component-config.json.html">component-config.json</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="config.json.html">config.json</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="datasources.json.html">datasources.json</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="middleware.json.html">middleware.json</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="middleware.development.json.html">middleware.development.json</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="model-config.json.html">model-config.json</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="server.js.html">server.js</a>
      
  </li>
  



      </ul>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Node-reference.html">Node reference</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="LoopBack-types.html">LoopBack types</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Geotype.html">Geopoint type</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Valid-names-in-LoopBack.html">Valid names in LoopBack</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Basic-model-object.html">Basic model object</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Connected-model-object.html">Connected model object</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Error-object.html">Error object</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="LoopBack-middleware.html">LoopBack middleware</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" tree-parent  ">
     <a class="show-hide" href="#"></span> 
    <a class="page-link" rel="nofollow" href="Publish-subscribe-messaging.html">Publish-subscribe messaging</a>
      
      <ul class="nav-list">
          

  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Strong-pub-sub.html">Strong Pub-sub</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Pub-sub-bridge.html">Pub-sub bridge</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="MQTT-adapter.html">MQTT adapter</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Redis-pub-sub-adapter.html">Redis pub-sub adapter</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Primus-pub-sub-adapter.html">Primus pub-sub adapter</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Pub-sub-example.html">Node pub-sub example app</a>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="Pub-sub-Loopback-example.html">LoopBack pub-sub example app</a>
      
  </li>
  



      </ul>
      
  </li>
  


  
  <li class=" leaf-node  ">
    
    <a class="page-link" rel="nofollow" href="All-tags.html">All tags</a>
      
  </li>
  



</ul>

        </nav>
        <!-- Content Column -->
        <div class="col-md-9">
            
<div class="post-header">
   <h1 class="post-title-main">操作フック</h1>
   
     
       <a target="_blank" href="https://github.com/strongloop/loopback.io/blob/gh-pages/pages/ja/lb3/Operation-hooks.md" class="githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit this page</a>
   
</div>

<div class="post-content">


  
   <div class="summary">
     操作フックは、作成・読取・更新・削除に関する高レベルの操作を実行するすべてのメソッドによって起動されます。LoopBackバージョン3.0の操作フックには多くの変更が加えられました。
   </div>
  



  
  
<div id="seealso">

  <p><b>See also</b>:</p>

  <ul>
    <li>
      <p><a href="Remote-hooks.html">Remote hooks</a></p>
    </li>
    <li>
      <p><a href="Remote-methods.html">Remote methods</a></p>
    </li>
    <li>
      <p><a href="Connector-hooks.html">Connector hooks</a></p>
    </li>
    <li>
      <p><a href="Tutorial-Adding-application-logic.html">Tutorial: Adding application logic</a></p>
    </li>
  </ul>

</div>




 
   
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
;$(function() {
  var level = parseInt(2, 10);
  if (level === 1) {level = 'h2'}
  if (level === 2) {level = 'h2,h3'}
  if (level === 3) {level = 'h2,h3,h4'}
  if (level === 4) {level = 'h2,h3,h4,h5'}

  // Add a new level for changelog files which use h1,h2,h3
  if (level === 0) {level = 'h1,h2,h3,h4,h5'}

  var toc = $('#toc')

  toc.toc({minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: level})

  /* this offset helps with the space taken up by the floating toolbar */
  toc.on('click', 'a', function() {
    var target = $(this.getAttribute('href')),
      scroll_target = target.offset().top

    $(window).scrollTop(scroll_target - 10)
    return false
  })
  .on('click', '.toc-expand-button', function() {
    toc.find('> ul').slideToggle('fast');
  })
})
</script>

<div id="toc">
  <span class="toc-title">Page Contents</span>
  <button type="button" class="btn btn-link toc-expand-button">
    <i class="fa fa-bars"></i>
  </button>
</div>

 

    
  <h2 id="概要">概要</h2>

<p><em>操作フック</em> は特定のメソッドに束縛されず、作成・読取・更新・削除に関する高レベルの操作を実行するすべてのメソッドから起動されます。</p>

<p>対象は、アプリケーションモデルが継承する <a href="https://apidocs.loopback.io/loopback/#persistedmodel">永続化モデル</a> のすべてのメソッドです。
操作フックを使用すると、それらの操作を呼び出す特定のメソッド（たとえば<code class="language-plaintext highlighter-rouge">create</code>・<code class="language-plaintext highlighter-rouge">save</code>・<code class="language-plaintext highlighter-rouge">updateOrCreate</code>）に関係なく、データを変更するアクションを割り込ませることができます。</p>

<p>APIは単純です。メソッド<code>Model.observe(<i>name</i>, <i>observer</i>)</code>で、<em><code class="language-plaintext highlighter-rouge">name</code></em> は操作フックの名前の文字列、例えば「before save」など、そして、
<em><code class="language-plaintext highlighter-rouge">observer</code></em> は <code class="language-plaintext highlighter-rouge">function observer(context, callback)</code> です。オブザーバーを継承する子供のモデルは、複数のオブザーバーを登録できます。</p>

<p>次の表は、PersistedModelのcreate・retrieve・update・deleteメソッドによって呼び出される操作フックをまとめたものです。</p>

<table>
  <tbody>
    <tr>
      <th>
        <p>メソッド&nbsp;→<br />&nbsp;</p>
        <p>操作フック ↓</p>
      </th>
      <th>find<br />findOne<br />findById</th>
      <th>exists</th>
      <th>count</th>
      <th>create</th>
      <th>upsert</th>
      <th>findOrCreate</th>
      <th>deleteAll<br />deleteById </th>
      <th>updateAll</th>
      <th>prototype<br />.save</th>
      <th>prototype<br />.delete</th>
      <th>prototype<br />.updateAttributes</th>
      <th>
        prototype<br />.replaceAttributes
      </th>
      <th>replaceById</th>
      <th>replaceOrCreate</th>
      <th>upsertWithWhere</th>
    </tr>
    <tr>
      <th>access</th>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <th>before save</th>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <th>after save</th>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <th>before delete</th>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <th>after delete</th>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <th>loaded</th>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">&nbsp;</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <th>persist</th>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td style="text-align: center;">X</td>
      <td>&nbsp;</td>
      <td style="text-align: center;">X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
    </tr>
  </tbody>
</table>

<h3 id="操作フックコンテキストオブジェクト">操作フックコンテキストオブジェクト</h3>

<p><code class="language-plaintext highlighter-rouge">context</code>オブジェクトは操作フックに固有で、<code class="language-plaintext highlighter-rouge">Model.beforeRemote</code>や<code class="language-plaintext highlighter-rouge">Model.afterRemote</code>を介して登録されたリモートフックに渡されるコンテキストオブジェクトとは何の関係もありません。詳細については、<a href="Remote-hooks.html">リモートフック</a> を参照してください。
コンテキストオブジェクトは、<code class="language-plaintext highlighter-rouge">loopback.getCurrentContext()</code>によって提供される「現在のコンテキスト」にも関係しないことに注意してください。</p>

<h4 id="すべてのフックと操作に共通のプロパティ">すべてのフックと操作に共通のプロパティ</h4>

<h5 id="ターゲットモデル">ターゲットモデル</h5>

<p><code class="language-plaintext highlighter-rouge">context.Model</code> プロパティは、操作の対象となるモデルのコンストラクタに設定されます。例えば、<code class="language-plaintext highlighter-rouge">Product.find()</code> では <code class="language-plaintext highlighter-rouge">context.Model = Product</code> をセットします。</p>

<h5 id="操作オプション">操作オプション</h5>

<p>モデルの特定のメソッド（操作）の呼び出し元が提供するオプションに、フックがアクセスできるようにするために、コンテキストオブジェクトには <code class="language-plaintext highlighter-rouge">options</code> プロパティがあります。</p>

<p>例えば、以下のようになります。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">FILTERED_PROPERTIES</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">immutable</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">birthday</span><span class="dl">'</span><span class="p">];</span>
<span class="nx">MyModel</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="dl">'</span><span class="s1">before save</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">filterProperties</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">skipPropertyFilter</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">FILTERED_PROPERTIES</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">unsetAttribute</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">FILTERED_PROPERTIES</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">delete</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// immutable is not updated</span>
<span class="nx">MyModel</span><span class="p">.</span><span class="nx">updateOrCreate</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="na">immutable</span><span class="p">:</span> <span class="dl">'</span><span class="s1">new value</span><span class="dl">'</span>
<span class="p">},</span> <span class="nx">cb</span><span class="p">);</span>

<span class="c1">// immutable is changed</span>
<span class="nx">MyModel</span><span class="p">.</span><span class="nx">updateOrCreate</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="na">immutable</span><span class="p">:</span> <span class="dl">'</span><span class="s1">new value</span><span class="dl">'</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="na">skipPropertyFilter</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">},</span> <span class="nx">cb</span><span class="p">);</span>
</code></pre></div></div>

<h5 id="共有フック状態プロパティ">共有フック状態プロパティ</h5>

<p>フック間（たとえば、「before save」と「after save」）でデータを共有するには、<code class="language-plaintext highlighter-rouge">ctx.hookState</code> プロパティを使用します。<code class="language-plaintext highlighter-rouge">ctx.hookState</code> プロパティの値は、1回の操作で呼び出されるすべてのフックで保持されます。</p>

<p>例えば、<code class="language-plaintext highlighter-rouge">MyModel.create()</code>は「access」「before save」「after save」フックを呼出しますが、それらは <code class="language-plaintext highlighter-rouge">ctx.hookState</code> に同じオブジェクトを持ちます。</p>

<p>対照的に、<code class="language-plaintext highlighter-rouge">ctx.options</code>は<code class="language-plaintext highlighter-rouge">MyModel.find()</code>や<code class="language-plaintext highlighter-rouge">MyModel.create()</code>のようなPersistedModelのメソッドが提供するoptions引数を使用して設定されます。
options引数が指定されなかった場合は、<code class="language-plaintext highlighter-rouge">ctx.options</code> は空のオブジェクトに設定されるため、フックは <code class="language-plaintext highlighter-rouge">ctx.options</code> が設定されているかどうかを確認する必要がありません。</p>

<h4 id="フックと操作固有のプロパティ">フックと操作固有のプロパティ</h4>

<p>上記の共通のプロパティに加えて、各フックは、操作の影響を受けるモデルインスタンスと適用された変更を識別する追加のプロパティを提供します。
一般的な規則は、コンテキストが<code class="language-plaintext highlighter-rouge">instance</code>プロパティまたは一組の<code class="language-plaintext highlighter-rouge">data</code>と<code class="language-plaintext highlighter-rouge">where</code>プロパティのいずれかを提供します。</p>

<h5 id="instance">instance</h5>

<p>このプロパティは、操作が単一のインスタンスに影響を与え、<em>かつ</em> すべてのモデルプロパティについて完全な更新・作成・削除が実行された時に、提供されます。
例えば、<code class="language-plaintext highlighter-rouge">PersistedModel.create()</code>などです。</p>

<h5 id="where--data">where + data</h5>

<p>操作が複数のインスタンスに影響を与える場合（例えば、<code class="language-plaintext highlighter-rouge">PersistedModel.updateAll()</code>）<em>または</em> モデルプロパティの一部に部分的な更新が行われる場合（例えば、<code class="language-plaintext highlighter-rouge">PersistedModel.prototype.updateAttributes()</code>）、コンテキストは、影響を受けたレコードを見つけるために使われる<a href="Where-filter.html">where filter</a>と、
なされるべき変更を含む<code class="language-plaintext highlighter-rouge">data</code>オブジェクトを提供する。</p>

<h5 id="isnewinstance">isNewInstance</h5>

<p>いくつかの操作は、CREATE操作とUPDATE操作を区別するためのフラグを提供します。詳細については、個々のフックのドキュメントを参照してください。</p>

<div class="alert alert-warning" role="alert">
  <p><i class="fa fa-warning"></i>
  <b>Important:</b></p>

  <p>特定のコネクタのみ <code class="language-plaintext highlighter-rouge">ctx.isNewInstance</code> をサポートしています。他のコネクタでは未定義です。
<a href="Operation-hooks-version-3.0-.html">ctx.isNewInstance サポートの確認</a>を参照してください。</p>

</div>

<h5 id="currentinstance">currentInstance</h5>

<p>このプロパティは、単一インスタンスの部分的な変更を実行するフックによって提供されます。
影響を受けるモデルインスタンスが含まれているため、値を読み取り専用（不変）として扱う必要があります。</p>

<h3 id="ctxisnewinstance-サポートの確認">ctx.isNewInstance サポートの確認</h3>

<p><code class="language-plaintext highlighter-rouge">ctx.isNewInstance</code> の最初の実装では、メモリ・MongoDB・MySQLコネクタのみがサポートされていました。
“after save”フックで返された値をテストすることで、コネクタがこの機能をサポートしているかどうかを確認することができます。</p>

<p>例えば以下のようにします。</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">MyModel</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="dl">'</span><span class="s1">after save</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">supports isNewInstance?</span><span class="dl">'</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">isNewInstance</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">);</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
<span class="c1">// It's important to provide a value for the id property</span>
<span class="c1">// Include also values for any required properties</span>
<span class="nx">MyModel</span><span class="p">.</span><span class="nx">updateOrCreate</span><span class="p">({</span>
  <span class="na">id</span><span class="p">:</span> <span class="mi">123</span>
<span class="p">},</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">);</span>
</code></pre></div></div>

<p>この機能がサポートされていない場合は、GitHub のコネクタプロジェクトで問題を報告してください。</p>

<h3 id="影響を受けるインスタンスへのアクセス">影響を受けるインスタンスへのアクセス</h3>

<p>単一のインスタンスのみに影響を与える操作（<code class="language-plaintext highlighter-rouge">PersistedModel.deleteAll</code>と<code class="language-plaintext highlighter-rouge">PersistedModel.updateAll</code>を除く、すべての作成・取得・更新・削除操作）は通常コンテキストオブジェクトに影響を受けたインスタンスを提供します。
ただし、操作に応じて、このインスタンスは変更可能な<code class="language-plaintext highlighter-rouge">ctx.instance</code>または読み取り専用の<code class="language-plaintext highlighter-rouge">ctx.currentInstance</code>のいずれかで提供されます。</p>

<table width="800">
  <thead>
    <tr>
      <th width="220">メソッド</th>
      <th width="200">before save</th>
      <th width="200">persist</th>
      <th width="160">after save</th>
      <th>before delete</th>
      <th>after delete</th>
    </tr>
  </thead>
  <tbody style="font-size: 85%;">    
    <tr>
      <td><code>create</code></td>
      <td><code>ctx.instance</code></td>
      <td><code>ctx<br />.currentInstance</code></td>
      <td><code>ctx.instance</code></td>
      <td style="text-align: center;">---</td>
      <td style="text-align: center;">---</td>
    </tr>
    <tr>
      <td><code>findOrCreate</code></td>
      <td><code>ctx.instance</code></td>
      <td><code>ctx<br />.currentInstance</code></td>
      <td><code>ctx.instance</code></td>
      <td style="text-align: center;">---</td>
      <td style="text-align: center;">---</td>
    </tr>
    <tr>
      <td><code>updateOrCreate</code></td>
      <td>n/a*</td>
      <td><code>ctx<br />.currentInstance</code></td>
      <td><code>ctx.instance</code></td>
      <td style="text-align: center;">---</td>
      <td style="text-align: center;">---</td>
    </tr>
    <tr>
      <td><code>upsertWithWhere</code></td>
      <td>n/a*</td>
      <td><code>ctx<br />.currentInstance</code></td>
      <td><code>ctx.instance</code></td>
      <td style="text-align: center;">---</td>
      <td style="text-align: center;">---</td>
    </tr>
    <tr>
      <td><code>updateAll</code></td>
      <td>n/a</td>
      <td>n/a</td>
      <td>n/a</td>
      <td style="text-align: center;">---</td>
      <td style="text-align: center;">---</td>
    </tr>
    <tr>
      <td><code>prototype.save</code></td>
      <td><code>ctx.instance</code></td>
      <td><code>ctx<br />.currentInstance</code></td>
      <td><code>ctx.instance</code></td>
      <td style="text-align: center;">---</td>
      <td style="text-align: center;">---</td>
    </tr>
    <tr>
      <td><code>prototype<br />.updateAttributes</code></td>
      <td><code>ctx<br />.currentInstance</code></td>
      <td><code>ctx<br />.currentInstance</code></td>
      <td><code>ctx.instance</code></td>
      <td style="text-align: center;">---</td>
      <td style="text-align: center;">---</td>
    </tr>
    <tr>
      <td><code>prototype.delete</code></td>
      <td style="text-align: center;">---</td>
      <td style="text-align: center;">---</td>
      <td style="text-align: center;">---</td>
      <td><code>ctx.where.id</code></td>
      <td><code>ctx.where.id</code></td>
    </tr>
    <tr>
      <td><code>deleteAll</code></td>
      <td style="text-align: center;">---</td>
      <td style="text-align: center;">---</td>
      <td style="text-align: center;">---</td>
      <td>n/a</td>
      <td>n/a</td>
    </tr>
    <tr>
      <td><code>replaceOrCreate</code></td>
      <td><code>ctx.instance</code></td>
      <td><code>ctx<br />.currentInstance</code></td>
      <td><code>ctx.instance</code></td>
      <td>---</td>
      <td>---</td>
    </tr>
    <tr>
      <td><code>prototype<br />.replaceAttributes<br />
replaceById</code>
      </td>
      <td><code>ctx.instance</code></td>
      <td><code>ctx<br />.currentInstance</code></td>
      <td><code>ctx.instance</code></td>
      <td>---</td>
      <td>---</td>
    </tr>
  </tbody>
</table>

<p>(*) 操作 <code class="language-plaintext highlighter-rouge">updateOrCreate</code>と<code class="language-plaintext highlighter-rouge">upsertWithWhere</code>は、 “before save”フックにインスタンスを提供しません。
操作がUPDATEまたはCREATEになるかどうかを事前に伝えることは不可能であるため、既存の「currentInstance」が操作の影響を受けるかどうかを知る方法はありません。</p>

<p>詳細については、次のセクションを参照してください。</p>

<h2 id="フック">フック</h2>

<p>LoopBackは、次の操作フックを提供します。</p>

<ul>
  <li><a href="Operation-hooks.html#access">access</a></li>
  <li><a href="Operation-hooks.html#before-save">before save</a></li>
  <li><a href="Operation-hooks.html#after-save">after save</a></li>
  <li><a href="Operation-hooks.html#before-delete">before delete</a></li>
  <li><a href="Operation-hooks.html#after-delete">after delete</a></li>
  <li><a href="Operation-hooks.html#loaded">loaded</a></li>
  <li><a href="Operation-hooks.html#persist">persist</a></li>
</ul>

<p>次の表は、PersistedModelメソッドが呼び出すフックの一覧です。</p>

<table>
  <tbody>
    <tr>
      <th width="160">メソッドの名前</th>
      <th>呼び出されるフック</th>
    </tr>
    <tr>
      <td>
        <p>all<br />find<br />findOne <br />findById  <br />exists<br />count </p>
      </td>
      <td>access, loaded</td>
    </tr>
    <tr>
      <td>create</td>
      <td>before save, after save, loaded, persist</td>
    </tr>
    <tr>
      <td>upsert (別名 updateOrCreate)</td>
      <td>access, before save, after save, loaded, persist</td>
    </tr>
    <tr>
      <td>upsertWithWhere</td>
      <td>access, before save, after save, loaded, persist</td>
    </tr>
    <tr>
      <td>findOrCreate</td>
      <td>access, before save*, after save*, loaded, persist</td>
    </tr>
    <tr>
      <td>deleteAll (destroyAll)<br />deleteById (destroyById)</td>
      <td>access, before delete, after delete</td>
    </tr>
    <tr>
      <td>updateAll</td>
      <td>access, before save, after save, persist</td>
    </tr>
    <tr>
      <td>prototype.save</td>
      <td>before save, after save, persist, loaded</td>
    </tr>
    <tr>
      <td>prototype.delete</td>
      <td>before delete, after delete</td>
    </tr>
    <tr>
      <td>prototype.<br />updateAttributes</td>
      <td>before save, after save, loaded, persist</td>
    </tr>
    <tr>
      <td>replaceOrCreate</td>
      <td>access, before save, after save, loaded, persist</td>
    </tr>
    <tr>
      <td>prototype.<br />replaceAttributes
        <br />replaceById
      </td>
      <td>before save, after save, loaded, persist</td>
    </tr>
  </tbody>
</table>

<p>(*) <code class="language-plaintext highlighter-rouge">findOrCreate</code> が既存のモデルを見つけたとき、saveフックは起動されません。
ただし、アトミック実装を提供するコネクタは、モデルが作成されるかどうかを事前に判断できないため、モデルが作成されていなくても<code class="language-plaintext highlighter-rouge">before save</code>を起動するかもしれません。</p>

<h3 id="access">access</h3>

<p><code class="language-plaintext highlighter-rouge">access</code> フックは、データベースがモデルに照会されるたび、つまり、<a href="https://apidocs.loopback.io/loopback/#persistedmodel">PersistedModel</a> の
<em>あらゆる</em> 作成・取得・更新・削除メソッドが呼び出されるときに起動します。
オブザーバーは、例えば追加の制限を加えるなどして、クエリを変更することができます。</p>

<div class="alert alert-info" role="alert">
  <p><i class="fa fa-info-circle"></i>
<b>Note:</b></p>

  <p>データベースからモデルインスタンスを読み込んだメソッドによって<code class="language-plaintext highlighter-rouge">access</code>フックが既に起動されているため、プロトタイプメソッドはフックを起動しません。</p>

  <p>たとえば、REST APIを使用してプロトタイプメソッドを呼び出すと、静的 <code class="language-plaintext highlighter-rouge">findById()</code> （「access」フックを起動する）とプロトタイプメソッドの2つのモデル呼び出しが要求されます。</p>

</div>

<p>コンテキストプロパティ</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Model</code> - 照会されるモデルのコンストラクタ</li>
  <li><code class="language-plaintext highlighter-rouge">query</code> - <code class="language-plaintext highlighter-rouge">where</code>・<code class="language-plaintext highlighter-rouge">include</code>・<code class="language-plaintext highlighter-rouge">order</code>フィールドを含むクエリ</li>
</ul>

<p>例：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">MyModel</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="dl">'</span><span class="s1">access</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">logQuery</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Accessing %s matching %s</span><span class="dl">'</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">modelName</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">);</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">MyModel</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="dl">'</span><span class="s1">access</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">limitToTenant</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">where</span><span class="p">.</span><span class="nx">tenantId</span> <span class="o">=</span> <span class="nx">loopback</span><span class="p">.</span><span class="nx">getCurrentContext</span><span class="p">().</span><span class="nx">tenantId</span><span class="p">;</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="before-save">before save</h3>

<p>before save フックは、モデル・インスタンスが変更（作成・更新）される前に起動されます。具体的には、以下のPersistedModelのメソッドが呼び出されたときです。</p>

<ul>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-create">create()</a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-upsert">upsert()</a></li>
  <li><a href="http://apidocs.loopback.io/loopback/#persistedmodel-upsertwithwhere">upsertWithWhere()</a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-findorcreate">findOrCreate()</a> - <code class="language-plaintext highlighter-rouge">findOrCreate</code>が既存のモデルを見つけた場合、saveフックを起動しません。ただし、アトミック実装を提供するコネクタは、モデルが作成されなくても <code class="language-plaintext highlighter-rouge">before save</code>フックを起動する可能性があります。これは、モデルが作成されるかどうかを事前に判断できないためです。</li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-updateall">updateAll()</a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-save">prototype.save()</a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-updateattributes">prototype.updateAttributes()</a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-replaceorcreate">replaceOrCreate()</a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-replacebyid">prototype.replaceById()</a> / <a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-replaceattributes">replaceAttributes()</a></li>
</ul>

<p>フックは、 <a href="Validating-model-data.html">モデル検証</a> 関数が呼び出される <em>前に</em> 起動されます。</p>

<div class="alert alert-success" role="alert">
  <p><i class="fa fa-check-square-o"></i>
  <b>Tip:</b> 
<code class="language-plaintext highlighter-rouge">before save</code> フックはバリデータが呼び出される前に起動されるので、空または欠損値が既定値で満たされていることを確認できます。</p>

</div>

<p>このフックをトリガするメソッドに応じて、コンテキストは次のプロパティセットのいずれかを持ちます。</p>

<ul>
  <li>単一モデルの完全保存
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Model</code> - 保存されるモデルのコンストラクタ</li>
      <li><code class="language-plaintext highlighter-rouge">instance</code> -  保存されるモデルのインスタンス。 値は<code class="language-plaintext highlighter-rouge">Model</code>クラスのインスタンスです。</li>
    </ul>
  </li>
  <li>おそらく複数のモデルの部分的更新
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Model</code> - 保存されるモデルのコンストラクタ</li>
      <li><code class="language-plaintext highlighter-rouge">where</code> - どのインスタンスが影響を受けるかを記述するwhereフィルタ</li>
      <li><code class="language-plaintext highlighter-rouge">data</code> - 更新中に適用される（部分的な）データ</li>
      <li><code class="language-plaintext highlighter-rouge">currentInstance</code> - 影響を受けるインスタンス</li>
    </ul>
  </li>
</ul>

<h4 id="ctxisnewinstance">ctx.isNewInstance</h4>

<p>before save フックは、<code class="language-plaintext highlighter-rouge">ctx.instance</code> が設定されている場合に、<code class="language-plaintext highlighter-rouge">ctx.isNewInstance</code> プロパティを次のように提供します。</p>

<ul>
  <li>すべてのCREATE操作で true です。</li>
  <li>すべてのUPDATEおよびREPLACE操作で false です。</li>
  <li><code class="language-plaintext highlighter-rouge">updateOrCreate</code>・<code class="language-plaintext highlighter-rouge">upsertWithWhere</code>・<code class="language-plaintext highlighter-rouge">replaceOrCreate</code>・<code class="language-plaintext highlighter-rouge">prototype.save</code>・<code class="language-plaintext highlighter-rouge">prototype.updateAttributes</code>・<code class="language-plaintext highlighter-rouge">updateAll</code> 操作は undefined です。</li>
</ul>

<h4 id="埋め込まれた関係">埋め込まれた関係</h4>

<p>別のモデルに<a href="Embedded-models-and-relations.html">埋め込まれている</a>モデルのbefore saveフックを定義することができます。
そして、包含モデルのインスタンスを更新または作成すると、埋め込まれたモデルの操作フックが起動されます。
この場合、コンテナモデルの新しいインスタンスのみが作成されるため、<code class="language-plaintext highlighter-rouge">ctx.isNewInstance</code> はfalseになります。</p>

<p>たとえば、<code class="language-plaintext highlighter-rouge">Customer emdedsOne Address</code> だとすると、Addressモデルに<code class="language-plaintext highlighter-rouge">before save</code>フックを定義し、新しいCustomerのインスタンスを作成すると操作フックが起動されます。</p>

<h4 id="before-save-フックでモデルデータを操作する">“before save” フックでモデルデータを操作する</h4>

<p>上で説明したように、コンテキストは <code class="language-plaintext highlighter-rouge">instance</code> プロパティ、または一組の <code class="language-plaintext highlighter-rouge">data</code> および  <code class="language-plaintext highlighter-rouge">where</code> プロパティのいずれかを提供します。
<code class="language-plaintext highlighter-rouge">ctx.instance</code>の完全なモデルインスタンスを公開すると、フックは独自モデルのインスタンスメソッドを呼び出すことができます（たとえば、住所などの注文データが変更されたときに <code class="language-plaintext highlighter-rouge">order.recalculateShippingAndTaxes()</code> を呼び出すことができます）。
LoopBackの作成・取得・更新・削除操作が可能な限りインスタンスを提供するのはこのためです。</p>

<p>インスタンスオブジェクトを提供することが実現できない場合として、2つの特徴的な例外があります。</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">PersistedModel.updateAll</code> は与えられた条件に一致する複数のインスタンスを更新します。
LoopBackはデータベースからデータをロードすることさえできません。これらのインスタンスを見つけて必要な変更を適用するのはデータベースの責任です。</li>
  <li><code class="language-plaintext highlighter-rouge">PersistedModel.updateAttributes</code> が部分的な更新を実行すると、モデルのプロパティの一部のみが変更されます。
LoopBackには利用可能なモデルインスタンスがありますが、データベース内でどのモデルプロパティを変更すべきかも知る必要があります。
操作対象のデータを <code class="language-plaintext highlighter-rouge">ctx.data</code>（変更すべきプロパティだけを含むプレーンオブジェクト）で渡すことで、フックの実装に、変更するプロパティを簡単に追加/削除できるようになります。
<code class="language-plaintext highlighter-rouge">ctx.currentInstance</code> を不変（読み取り専用）として扱う限り、変更されるモデルインスタンスにアクセスできます。</li>
</ol>

<h4 id="例">例</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">MyModel</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="dl">'</span><span class="s1">before save</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">updateTimestamp</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">updated</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">updated</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">MyModel</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="dl">'</span><span class="s1">before save</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">computePercentage</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">percentage</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">part</span> <span class="o">/</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">part</span> <span class="o">&amp;&amp;</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">percentage</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">part</span> <span class="o">/</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">part</span> <span class="o">||</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// エラーを報告するか、欠けているプロパティをDBから読み取る</span>
  <span class="p">}</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<h4 id="不要なプロパティの削除">不要なプロパティの削除</h4>

<p>モデルインスタンス内のプロパティを削除（設定解除）するには、その値を未定義に設定するか、またはプロパティを削除するだけで十分ではありません。
代わりに、インスタンスには<code class="language-plaintext highlighter-rouge">unsetAttribute(name)</code> を呼び出さなければなりません。ただし、コンテキストにdataプロパティがある場合を処理することを忘れないでください！
dataオブジェクトは単純なオブジェクトなので、削除演算子を使用して通常の方法でプロパティを削除できます。</p>

<p>例：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">MyModel</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="dl">'</span><span class="s1">before save</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">removeUnwantedField</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">unsetAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">unwantedField</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">unwantedField</span><span class="p">;</span>
 <span class="err"> </span><span class="p">}</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>これにより、フィールドが完全に削除され、誤ったデータがデータベースに挿入されなくなります。</p>

<h3 id="after-save">after save</h3>

<p><code class="language-plaintext highlighter-rouge">after save</code> フックは、モデルの変更がデータソース上で永続化された後に呼び出されます。 具体的には、PersistedModel の以下のメソッドが呼び出されたときです。</p>

<ul>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-create">create()</a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-upsert">upsert()</a></li>
  <li><a href="http://apidocs.loopback.io/loopback/#persistedmodel-upsertwithwhere">upsertWithWhere()</a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-findorcreate">findOrCreate()</a>*</li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-updateall">updateAll()</a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-save">prototype.save()</a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-updateattributes">prototype.updateAttributes()</a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-replaceattributes">prototye.replaceAttributes()</a> / <a href="https://apidocs.loopback.io/loopback/#persistedmodel-replacebyid">replaceById()</a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-replaceorcreate">replaceOrCreate()</a></li>
</ul>

<p>(*) <code class="language-plaintext highlighter-rouge">findOrCreate</code> が既存のモデルを見つけると、saveフックは起動されません。
ただし、アトミック実装を提供するコネクタは、モデルが作成されるかどうかを事前に判断できないため、
モデルが作成されていなくても<code class="language-plaintext highlighter-rouge">before save</code>フックを起動する可能性があります。</p>

<p>このフックを起動するメソッドに応じて、コンテキストは次のプロパティセットのいずれかを持ちます。</p>

<ul>
  <li>単一のモデルが更新された場合：
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Model</code> - 保存されるモデルのコンストラクタです。</li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">instance</code> - 保存されたモデルのインスタンス。 値は<code class="language-plaintext highlighter-rouge">Model</code>クラスのインスタンスであり、データストアによって計算された更新値（たとえば、自動生成ID）を含みます。</p>

        <div class="alert alert-info" role="alert">
          <p><i class="fa fa-info-circle"></i>
<b>Note:</b></p>

          <p>after saveフックは、<code class="language-plaintext highlighter-rouge">ctx.instance</code> に加えられた変更を呼び出し元（RESTクライアント）に返しますが、データベースに保存はしません。</p>

        </div>
      </li>
    </ul>
  </li>
</ul>
<p>&lt;/div&gt;</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Model.updateAll</code>によって複数のモデルの部分的な更新が行われた場合：
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Model</code> - 保存されるモデルのコンストラクタです。</li>
      <li><code class="language-plaintext highlighter-rouge">where</code> - 問い合わせられたインスタンスを記述するwhereフィルタ。以下の警告を参照。</li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">data</code>- 更新中に適用された（部分的な）データ。</p>

        <p>注：after saveフックで 「where」クエリを使用して、影響を受けるモデルを確実に見つけることはできません。次の呼び出しを考えてみましょう。</p>

        <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">MyModel</span><span class="p">.</span><span class="nx">updateAll</span><span class="p">({</span> <span class="na">color</span><span class="p">:</span> <span class="dl">'</span><span class="s1">yellow</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">color</span><span class="p">:</span> <span class="dl">'</span><span class="s1">red</span><span class="dl">'</span> <span class="p">},</span> <span class="nx">cb</span><span class="p">);</span>
</code></pre></div>        </div>

        <p>「after save」フックが実行される時点では、<code class="language-plaintext highlighter-rouge">{ color: 'yellow' }</code>の条件にマッチするレコードは存在しません。</p>
      </li>
    </ul>
  </li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">after save</code> hook provides the <code class="language-plaintext highlighter-rouge">ctx.isNewInstance</code> property whenever <code class="language-plaintext highlighter-rouge">ctx.instance</code> is set, with the following values:
<code class="language-plaintext highlighter-rouge">after save</code> フックは、<code class="language-plaintext highlighter-rouge">ctx.instance</code>がセットされる時はいつでも<code class="language-plaintext highlighter-rouge">ctx.isNewInstance</code> プロパティを以下の値に設定して提供します。</p>

<ul>
  <li>全ての CREATE 操作の後なら True</li>
  <li>全ての UPDATE/REPLACE 操作の後なら false</li>
  <li><code class="language-plaintext highlighter-rouge">updateOrCreate</code>・<code class="language-plaintext highlighter-rouge">prototype.save</code>・<code class="language-plaintext highlighter-rouge">prototype.updateAttributes</code>操作は、新しいインスタンスが作成されたか、既存のインスタンスを更新したかを、コネクタが知らせることが必要。
コネクタがこの情報を提供する場合、<code class="language-plaintext highlighter-rouge">ctx.isNewInstance</code>は true またはfalse。
コネクタがまだこの機能をサポートしていない場合は、値は undefined。</li>
</ul>

<div class="alert alert-warning" role="alert">
  <p><i class="fa fa-warning"></i>
  <b>Important:</b></p>

  <p>特定のコネクタのみが、<code class="language-plaintext highlighter-rouge">ctx.isNewInstance</code>をサポートしています。他のコネクタでは未定義です。
<a href="#checking-for-support-of-ctx.isnewinstance">ctx.isNewInstance サポートの確認</a>を参照してください。</p>

</div>

<h4 id="埋め込まれた関係-1">埋め込まれた関係</h4>

<p>別のモデルに<a href="Embedded-models-and-relations.html">埋め込まれ</a>ているモデルの<code class="language-plaintext highlighter-rouge">after save</code>フックを定義することができます。
そして、包含モデルのインスタンスを更新または作成すると、埋め込みモデルの操作フックが起動されます。
これが発生する と、コンテナモデルの新しいインスタンスのみが作成されるため、<code class="language-plaintext highlighter-rouge">ctx.isNewInstance</code> はfalseになります。</p>

<p>たとえば、<code class="language-plaintext highlighter-rouge">Customer emdedsOne Address</code> だとすると、Addressモデルに<code class="language-plaintext highlighter-rouge">after save</code>フックを定義し、
新しいCustomerのインスタンスを作成すると操作フックが起動されます。</p>

<h4 id="例-1">例</h4>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">MyModel</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="dl">'</span><span class="s1">after save</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Saved %s#%s</span><span class="dl">'</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">modelName</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">instance</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Updated %s matching %j</span><span class="dl">'</span><span class="p">,</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">pluralModelName</span><span class="p">,</span>
      <span class="nx">ctx</span><span class="p">.</span><span class="nx">where</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="before-delete">before delete</h3>

<p><code class="language-plaintext highlighter-rouge">before delete</code>フックは、モデルがデータソースから削除される時に起動されます。具体的には、PersistedModelの以下のメソッドが呼び出されたときです。</p>

<ul>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-destroyall"><code class="language-plaintext highlighter-rouge">destroyAll()</code></a> (<code class="language-plaintext highlighter-rouge">deleteAll()</code> と同じ)</li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-destroybyid"><code class="language-plaintext highlighter-rouge">destroyById()</code></a>(<code class="language-plaintext highlighter-rouge">deleteById()</code> と同じ)</li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-destroy"><code class="language-plaintext highlighter-rouge">prototype.destroy()</code></a> (<code class="language-plaintext highlighter-rouge">prototype.delete()</code> と同じ)</li>
</ul>

<div class="alert alert-warning" role="alert">
  <p><i class="fa fa-warning"></i>
  <b>Important:</b></p>

  <p><code class="language-plaintext highlighter-rouge">before delete</code> 操作フックは、リレーショナルまたはNoSQLデータベースなどのバックエンドのデータストアがこの情報を提供していないため、削除されたモデルインスタンスIDのリストを受け取りません。
ただし、<em>単一のモデルインスタンスを削除する場合</em> 、削除されるインスタンスの<code class="language-plaintext highlighter-rouge">id</code>を含む <code class="language-plaintext highlighter-rouge">ctx.where</code> をフックが受け取ります。</p>

</div>

<p>コンテキストプロパティ</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Model</code> - 照会されるモデルのコンストラクタ。</li>
  <li><code class="language-plaintext highlighter-rouge">where</code> - どのインスタンスが削除されるかを記述するwhereフィルタ。</li>
</ul>

<p>例：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">MyModel</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="dl">'</span><span class="s1">before delete</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Going to delete %s matching %j</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">pluralModelName</span><span class="p">,</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">where</span><span class="p">);</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>なんらかの条件に基づいてモデルの削除を拒否するには、<code class="language-plaintext highlighter-rouge">next()</code>にエラーを渡して、削除操作を中止します。</p>

<p>例：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">subscriptions</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//Stop the deletion of this Client</span>
  <span class="kd">var</span> <span class="nx">err</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Client has an active subscription, cannot delete</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">err</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
  <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="after-delete">after delete</h3>

<div class="alert alert-warning" role="alert">
  <p><i class="fa fa-warning"></i>
  <b>Important:</b></p>

  <p><code class="language-plaintext highlighter-rouge">after delete</code> 操作フックは、リレーショナルまたはNoSQLデータベースなどのバックエンドのデータストアがこの情報を提供していないため、削除されたモデルインスタンスIDのリストを受け取りません。
ただし、<em>単一のモデルインスタンスを削除する場合</em> 、削除されたインスタンスの<code class="language-plaintext highlighter-rouge">id</code>を含む <code class="language-plaintext highlighter-rouge">ctx.where</code> をフックが受け取ります。</p>

</div>

<p>The <code class="language-plaintext highlighter-rouge">after delete</code> hook is triggered after some models are removed from the datasource, specifically when the following methods of PersistedModel are called:
<code class="language-plaintext highlighter-rouge">after delete</code>フックは、モデルがデータソースから削除された時に起動されます。具体的には、PersistedModelの以下のメソッドが呼び出されたときです。</p>

<ul>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-destroyall"><code class="language-plaintext highlighter-rouge">destroyAll()</code></a> (<code class="language-plaintext highlighter-rouge">deleteAll()</code>と同じ)</li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-destroybyid"><code class="language-plaintext highlighter-rouge">destroyById()</code></a>(<code class="language-plaintext highlighter-rouge">deleteById()</code>と同じ)</li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-destroy"><code class="language-plaintext highlighter-rouge">prototype.destroy()</code></a> (<code class="language-plaintext highlighter-rouge">prototype.delete()</code>と同じ)</li>
</ul>

<p>コンテキストプロパティ</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Model</code> - 照会されたモデルのコンストラクタ</li>
  <li><code class="language-plaintext highlighter-rouge">where</code> -  削除されたインスタンスを記述するwhereフィルタ</li>
</ul>

<p>例：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">MyModel</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="dl">'</span><span class="s1">after delete</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Deleted %s matching %j</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">pluralModelName</span><span class="p">,</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">where</span><span class="p">);</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="loaded">loaded</h3>

<p>このフックは、PersistedModelの以下のメソッドによって起動されます。</p>

<ul>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-find"><code class="language-plaintext highlighter-rouge">find()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-findone"><code class="language-plaintext highlighter-rouge">findOne()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-findbyid"><code class="language-plaintext highlighter-rouge">findById()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-exists"><code class="language-plaintext highlighter-rouge">exists()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-count"><code class="language-plaintext highlighter-rouge">count()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-create"><code class="language-plaintext highlighter-rouge">create()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-upsert"><code class="language-plaintext highlighter-rouge">upsert()</code></a> (<code class="language-plaintext highlighter-rouge">updateOrCreate()</code>と同じ)</li>
  <li><a href="http://apidocs.loopback.io/loopback/#persistedmodel-upsertwithwhere"><code class="language-plaintext highlighter-rouge">upsertWithWhere()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-findorcreate"><code class="language-plaintext highlighter-rouge">findOrCreate()</code></a>*</li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-save"><code class="language-plaintext highlighter-rouge">prototype.save()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-updateattributes"><code class="language-plaintext highlighter-rouge">prototype.updateAttributes()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-replaceorcreate"><code class="language-plaintext highlighter-rouge">replaceOrCreate()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-replaceattributes"><code class="language-plaintext highlighter-rouge">prototype.replaceAttributes()</code></a>
/ <a href="https://apidocs.loopback.io/loopback/#persistedmodel-replacebyid"><code class="language-plaintext highlighter-rouge">replaceById()</code></a></li>
</ul>

<div class="alert alert-warning" role="alert">
  <p><i class="fa fa-warning"></i>
  <b>Important:</b></p>

  <p>既定では、 <code class="language-plaintext highlighter-rouge">create</code> と <code class="language-plaintext highlighter-rouge">updateAttributes</code>は、 コールバックに返されたモデルインスタンスへデータベースの更新を適用しないので、「loaded」フックによって行われた変更は破棄されます。この動作を変更するには、モデルごとのオプションで <code class="language-plaintext highlighter-rouge">updateOnLoad: true</code> を設定します。</p>

</div>

<p>LoopBackは、コネクターがデータを読み取った後で、そのデータからモデルインスタンスを作成する前に、このフックを呼び出します。
これにより、フックはデータを復号化することができます（たとえば）。注：このフックは、フルモデルのインスタンスではなく、未加工のデータベースデータで呼び出されます。</p>

<p>コンテキストプロパティ</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">data</code> - コネクタによって返されたデータ（データベースからロードされたもの）</li>
</ul>

<h3 id="persist">persist</h3>

<p>このフックは、データをデータソースに永続化する操作、具体的にはPersistedModelの次のメソッドによって起動されます。</p>

<ul>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-create"><code class="language-plaintext highlighter-rouge">create()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-upsert"><code class="language-plaintext highlighter-rouge">upsert()</code></a> (<code class="language-plaintext highlighter-rouge">updateOrCreate()</code> と同じ)</li>
  <li><a href="http://apidocs.loopback.io/loopback/#persistedmodel-upsertwithwhere"><code class="language-plaintext highlighter-rouge">upsertWithWhere()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-findorcreate"><code class="language-plaintext highlighter-rouge">findOrCreate()</code></a>*</li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-save"><code class="language-plaintext highlighter-rouge">prototype.save()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-updateattributes"><code class="language-plaintext highlighter-rouge">prototype.updateAttributes()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-updateall"><code class="language-plaintext highlighter-rouge">updateAll()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-replaceorcreate"><code class="language-plaintext highlighter-rouge">replaceOrCreate()</code></a></li>
  <li><a href="https://apidocs.loopback.io/loopback/#persistedmodel-prototype-replaceattributes"><code class="language-plaintext highlighter-rouge">prototype.replaceAttributes()</code></a>
/ <a href="https://apidocs.loopback.io/loopback/#persistedmodel-replacebyid"><code class="language-plaintext highlighter-rouge">replaceById()</code></a></li>
</ul>

<p>このフックと「before save 」フックを混同しないでください：</p>

<ul>
  <li><strong>before save</strong> – 保存しようとしているモデルインスタンスを観察して操作するために、このフックを使います。（たとえば、国コードが設定されていて、国名がなく、国名をセットしたい場合）</li>
  <li><strong>persist</strong> – データソースに永続化される直前のデータを監視（および操​​作）するためにこのフックを使います。（たとえば、データベース内の値を暗号化したい場合）</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">create</code> の最中、<code class="language-plaintext highlighter-rouge">persist</code> フックで行った変更は、データベースに反映されます。
しかし、<code class="language-plaintext highlighter-rouge">create</code>のコールバックによって得られた <code class="language-plaintext highlighter-rouge">instance</code> への変更は、反映されません。</p>

<p>第2に、アトミックを実装するコネクターで<code class="language-plaintext highlighter-rouge">findOrCreate</code>は、既存のレコードが後でデータベース内で見つかった場合でも、毎回オブジェクトの新しいインスタンスが作成されます。そのため、</p>

<ul>
  <li><a href="http://ctx.data.id/"><code class="language-plaintext highlighter-rouge">ctx.data.id</code></a> と <a href="http://ctx.currentinstance.id/"><code class="language-plaintext highlighter-rouge">ctx.currentInstance.id</code></a> は新しいIDがセットされます。</li>
  <li><code class="language-plaintext highlighter-rouge">ctx.isNewInstance</code> は <code class="language-plaintext highlighter-rouge">true</code> です。</li>
</ul>

<p>コンテキストプロパティ</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">data</code> - コネクタに送信されるデータ（データベースに保存されます）</li>
  <li><code class="language-plaintext highlighter-rouge">currentInstance</code> - 影響を受けるモデルインスタンス</li>
  <li><code class="language-plaintext highlighter-rouge">isNewInstance</code> - 下記参照</li>
</ul>

<p>このフックで<code class="language-plaintext highlighter-rouge">ctx.isNewInstance</code>は、</p>

<ul>
  <li>全ての CREATE 操作において true</li>
  <li>全ての UPDATE 操作においてい false</li>
  <li>updateOrCreate・upsertWithWhere・replaceOrCreate・prototype.save・prototype.updateAttributes・updateAll 操作については undefined</li>
</ul>

<h2 id="afterinitialize-フック">afterInitialize フック</h2>

<div class="alert alert-warning" role="alert">
  <p><i class="fa fa-warning"></i>
  <b>Important:</b></p>

  <p><code class="language-plaintext highlighter-rouge">afterInitialize</code> は厳密には操作フックではありません。実際には非推奨ではない唯一の<a href="/doc/en/lb2/Model-hooks.html">モデルフック</a>です。</p>

  <p>これは同期メソッドであり、コールバック関数は使用しません。フックでロジックを実行した後に next() を呼び出す必要はありません。</p>

</div>

<p>このフックは、モデルが初期化された後に呼び出されます。</p>

<h3 id="例-2">例</h3>

<p><strong>/common/models/coffee-shop.js</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
CoffeeShop.afterInitialize = function() {
  //your logic goes here
};
...
</code></pre></div></div>

<p>ほとんどの操作は、実際にアクションを実行する前に、モデルを初期化する必要があるが、initializeイベントが起動されていないいくつかの例がある。
例えば、<code class="language-plaintext highlighter-rouge">exists</code>, <code class="language-plaintext highlighter-rouge">count</code> や一括更新のRESTエンドポイントへのHTTPリクエストなどである。</p>

<h2 id="モデルフックからの移行">モデルフックからの移行</h2>

<p>次の表は、推奨されていない各<a href="/doc/en/lb2/Model-hooks.html">モデルフック</a>に代わって使用する新しいフックを示しています。</p>

<table>
  <thead>
    <tr>
      <th>モデルフック</th>
      <th>代替となる操作フック</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>beforeValidate</td>
      <td>before save</td>
    </tr>
    <tr>
      <td>afterValidate</td>
      <td>persist</td>
    </tr>
    <tr>
      <td>beforeCreate</td>
      <td>before save</td>
    </tr>
    <tr>
      <td>afterCreate</td>
      <td>after save</td>
    </tr>
    <tr>
      <td>beforeSave</td>
      <td>before save</td>
    </tr>
    <tr>
      <td>afterSave</td>
      <td>after save</td>
    </tr>
    <tr>
      <td>beforeUpdate</td>
      <td>before save</td>
    </tr>
    <tr>
      <td>afterUpdate</td>
      <td>after save</td>
    </tr>
    <tr>
      <td>beforeDestroy</td>
      <td>before delete</td>
    </tr>
    <tr>
      <td>afterDestroy</td>
      <td>after delete</td>
    </tr>
  </tbody>
</table>




    <div class="tags">
      
        <b>Tags: </b>
        
        
          
            <a href="tag_application_logic.html" class="tags-item" role="button">application_logic</a>
            
        
      
    </div>
</div>

<hr class="shaded"/>

<footer id="container">
            <div class="row">
                <div class="col-md-6 footer-left">
               &copy;2021 IBM / StrongLoop. All rights reserved. <br />
 Site last generated: Mar 22, 2021
              </div>
              <div class="col-md-6 footer-right">
                <p><img src="https://loopback.io/images/company_logo.png" alt="Company logo"/></p>
              </div>
            </div>
</footer>


        </div>
        <!-- /.row -->
</div>
<!-- /.container -->
    </div>
</body>

</html>
